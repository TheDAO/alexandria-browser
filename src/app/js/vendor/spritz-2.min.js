///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
// Spritz JavaScript SDK  version 2.0.0
// Wed Feb 11 2015 17:30:37 GMT-0700 (MST)
//
// Copyright (c) 2015 All Right Reserved, http://www.spritzinc.com/
//
// This source is subject to the Spritz Developer License.
// Please see http://www.spritzinc.com/spritz-developers-agreement for more information.
// All other rights reserved.
//
// Spritz JavaScript SDK uses the following open source software:
//     Closure Tools:   Home Page: developers.google.com/closure/library   License: www.apache.org/licenses/LICENSE-2.0
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

!function(a,b,c){function d(){if(b.spritz_sdk_root);else{var a=c.getElementById("spritzjs");if(null===a)b.spritz_sdk_root="//sdk.spritzinc.com/js/2.0.0";else{var d=a.getAttribute("src"),e=d.split("/"),f="";if(e.length<3)f=".";else for(var g=0;g<e.length-2;g++)f+=e[g],f+="/";b.spritz_sdk_root=f}}}function e(){if(!c.getElementById("spritz-css")){var a=c.getElementsByTagName("head")[0],d=c.createElement("link");d.id="spritz-css",d.rel="stylesheet",d.type="text/css",d.href=b.spritz_sdk_root,"/"!==d.href.substring(d.href.length-1)&&(d.href+="/"),d.href+="css/spritz.min.css",d.media="all",a.appendChild(d)}}function f(a,b,c,d,e){this.model=i.model,this.word=a,this.orp=b,this.multiplier=c,this.position=d,this.flags=e}function g(a,b,c,d,e,f,g){this.seekType=i.model.SpritzText.SeekType,this.contentVersionId=a,this.words=b,this.duration=c,this.wordCount=d,this.rawWordCount=e,this.locale=f,this.version=g,this.index=0,this.progressTracker=null}function h(a,c){var d="SpritzReadingPanel: ";i.utils.debug(3,d+"Created "+d);var e=Object.freeze({ready:0,running:1,paused:2,completed:3}),f=i.helper.createCanvas(i.constants.CSSClasses.CANVAS,c.redicleWidth,c.redicleHeight);a.appendChild(f),f.addEventListener("click",function(){i.helper.dispatchEvent(a,"redicleClick")});var g=f.getContext("2d"),h=c.redicle.fontName,j="Arial, sans-serif",l=.5,m=c.redicle.redicleLine?.01:0,n=0,o=0,p=0,q=0,r=0,s=i.utils.isChrome(),t=i.utils.isFirefox(),u=null,v=c.defaultSpeed,w=null,x=null,y=0,z=null,A=0,B=!0,C=e.ready,D=c.redicle.textHighlightPaintColor,E=c.redicle.countdownColor,F=0,G=0,H=c.redicle.sizeable,I=c.redicle.loadFonts,J=0,K=0,L=0,M=0,N=0,O=0,P=0,Q=0,R=0,S=0,T=0,U=0,V=0,W=0,X=0,Y=0,Z=0,$=0,_=0,ab="",bb="",cb="",db="",eb=function(){ab=J+"px "+h,bb="bold "+ab,cb=ab,db=bb},fb=function(){if(F=f.width,G=f.height,g=f.getContext("2d"),g.save(),g.restore(),"devicePixelRatio"in b&&b.devicePixelRatio>1){var a=b.devicePixelRatio,e=f.width,h=f.height;F=f.width=e*a,G=f.height=h*a,f.style.width=e+"px",f.style.height=h+"px"}J=Math.round(f.height*l),t?(X=2,Y=2,Z=0):(X=1,Y=3,Z=-(.088*G)),Y=Y*G/60,K=Math.round(.56*J+.5),L=Math.round(.44*J+.5),M=K+L,N=Math.round(G*c.redicle.crossHairHeight),O=Math.round(o+(F-o-p)*c.redicle.crossHairHorizontalPosition),P=Math.round((G-q-r)/2),Q=P-Math.round((K+L)/2)+Z,R=0,S=F,T=Math.round(F*n),U=Math.round(G*m),V=O-o,W=F-p-O,$=U+N,_=G-q-r-2*$,g.textBaseline="top",g.textAlign="left",eb();var j=3;i.utils.debug(j,d+"dimensions: "+F+"x"+G),i.utils.debug(j,d+"fontSizeHeight: "+J),i.utils.debug(j,d+"ascent: "+K),i.utils.debug(j,d+"descent: "+L),i.utils.debug(j,d+"focus: "+O+","+P),i.utils.debug(j,d+"textY: "+Q),i.utils.debug(j,d+"fontRealHeight: "+M),i.utils.debug(j,d+"textOverflow, top: "+X+", bottom: "+Y),i.utils.debug(j,d+"textNormalPaint: "+ab),i.utils.debug(j,d+"textNormalBoldPaint: "+bb)},gb=function(a,b,c,d,e,f){g.lineWidth=e,g.strokeStyle=f,g.beginPath(),g.moveTo(a,b),g.lineTo(c,d),g.stroke()},hb=function(){var a=o+T,b=f.width-p-T,d=q+U,e=f.height-r-U;c.redicle.redicleLine&&(gb(a,d,b,d,c.redicle.redicleLineWidth,c.redicle.redicleLineColor),gb(a,e,b,e,c.redicle.redicleLineWidth,c.redicle.redicleLineColor)),c.redicle.crossHair&&(gb(O,d,O,d+N,c.redicle.crossHairWidth,c.redicle.crossHairColor),gb(O,e-N,O,e,c.redicle.crossHairWidth,c.redicle.crossHairColor))},ib=function(a,b){var c=s?"":","+j;g.font=b+c;var d=g.measureText(a);return d.width},jb=function(a,b,c,d,e){var f=s?"":","+j;g.font=b+f,g.fillStyle=c,g.fillText(a,d,e)},kb=function(a,b,c,d,e){g.fillStyle=e,g.fillRect(a,b,c,d)},lb=function(){g.clearRect(o,q,f.width-p,f.height-r),kb(o,q,f.width-p,f.height-r,c.redicle.backgroundColor)},mb=function(){D=B?c.redicle.textHighlightPaintColor:c.redicle.textNormalPaintColor},nb=function(){return u},ob=function(){if(C===e.running){vb();var a=nb().getNextWord();if(null===a){if(C=e.completed,yb(c.placeholderText.endText,c.placeholderText.endTextColor),w){var b=w;w=null,b()}}else ub(a.word,a.orp,a.position,a.isBold()),z=setTimeout(function(){z=null,ob()},sb(a.multiplier))}else i.utils.debug(2,d+"displayNextWord interrupted on word # "+nb().getCurrentIndex()+" because of state: "+C)},pb=function(){A=(new Date).getTime(),qb(this)},qb=function(){var a=(new Date).getTime()-A,b=a/c.redicle.countdownTime,d=Math.max(V*b,0),e=Math.max(W*b,0),g=f.height-q-r,h=f.width-o-p;lb(),kb(o+d,q,h-d-e,g,E),hb(),tb(),O>=d||e<=f.width-O?z=setTimeout(function(){z=null,qb()},c.redicle.countdownSlice):(lb(),hb(),tb(),ob())},rb=function(){return v},sb=function(a){return(1+a/100)*y},tb=function(){var a=u.getCurrentWord();ub(a.word,a.orp,a.position,a.isBold())},ub=function(a,b,d,e){if(null!=a&&0!=a.length){var f,g,h=Q;e?(f=bb,g=db):(f=ab,g=cb);var i,j,k,l,m,n,o=a.length;0===b?(i=null,l=0):(i=a.substring(0,b),l=Math.round(ib(i,f))),j=a.substring(b,b+1),m=Math.round(ib(j,g)),n=Math.round(m/2),k=b==o-1?null:a.substring(b+1),l>0&&jb(i,f,c.redicle.textNormalPaintColor,O-l-n,h),jb(j,g,D,O-n,h),null!=k&&jb(k,f,c.redicle.textNormalPaintColor,O+n,h)}},vb=function(){g.fillStyle=c.redicle.backgroundColor,g.clearRect(R,$,S-R,_),g.fillRect(R,$,S-R,_)},wb=function(){var a=f.width,b=f.height;a===F&&b===G?i.utils.debug(3,d+"dimensions unchanged: "+F+"x"+G):(i.utils.debug(3,d+"dimensions changed: "+F+"x"+G+" -> "+a+"x"+b),f.width=a,f.height=b,fb())},xb=function(a){var b=M,c=f.width-(o+p)-2*Math.round(f.width*n);if(ib(a,ab)>c)do b--,g.font=b+"px "+h+(t?", "+j:"");while(g.measureText(a).width>c);return b},yb=function(a,b){if(a){vb(),eb();var d=Math.round(f.width*n)+o,e=xb(a),g=e+"px "+h,i=Math.round((f.height-q-r)/2),j=0;t&&(j=5);var k=ib("M",g)+ib("p",g)/2,l=i-k/2+j,m=b||c.redicle.textNormalPaintColor;jb(a,g,m,d,l)}};!function(){var a=I?[h]:[];k(a,function(){fb(),g.fillStyle=c.redicle.backgroundColor,g.fillRect(0,0,f.width,f.height),hb(),u?tb():yb(c.placeholderText.startText,c.placeholderText.startTextColor)})}(),this.getCurrentText=function(){return nb()},this.setCurrentText=function(a){null!=a&&(u=a,vb(),C===e.running&&(this.pauseText(),tb()),C===e.paused&&tb(),C===e.ready&&yb(c.placeholderText.startText,c.placeholderText.startTextColor),C===e.completed&&(vb(),yb(c.placeholderText.endText,c.placeholderText.endTextColor)),y=u.computeStandardDelay(v))},this.getCurrentTextSpeed=function(){return rb()},this.setCurrentTextSpeed=function(a){v=a,null!==u&&(y=u.computeStandardDelay(v))},this.getCurrentPosition=function(){return null!=u?u.getCurrentIndex():-1},this.setCurrentPosition=function(a){null!=u&&u.setCurrentIndex(a)},this.getCurrentState=function(){return C},this.setCurrentState=function(a){C=a},this.getHighlightBestLetter=function(){return B},this.setHighlightBestLetter=function(a){B=a,mb()},this.getOnCompleteCallback=function(){return x},this.setOnCompleteCallback=function(a){x=a},this.isPaused=function(){return C===e.paused},this.isReady=function(){return C===e.ready},this.isRunning=function(){return C===e.running},this.isCompleted=function(){return C===e.completed},this.displayWord=function(a,b,c){ub(a,b,0,c)},this.eraseWord=function(){vb()},this.displayText=function(a,b){if(i.utils.debug(3,d+"Displaying text with "+a.size()+" words in "+v+" words/min"),u=a,x=b,null!==u&&(y=u.computeStandardDelay(v)),u.hasNextWord())w=x,C=e.running,H&&wb(),mb(),pb();else if(null!=w){var c=w;w=null,c()}},this.displayPlaceholderText=function(a,b){lb.call(this),hb.call(this),yb(a,b)},this.pauseText=function(){C==e.running&&(null!=z&&(clearTimeout(z),z=null),u.getCurrentIndex()>0&&u.setCurrentIndex(u.getCurrentIndex()),C=e.paused),C=e.paused},this.resumeText=function(a){u?(w=x,u.hasNextWord()?(i.utils.debug(3,d+"Resuming text with "+u.size()+" words at word # "+(u.getCurrentIndex()+1)),C=e.running,H&&wb(),mb(),"undefined"==typeof a||a?pb():(lb(),hb(),0===u.getCurrentIndex()?pb():ob())):i.utils.debug(2,d+"Cannot resume Text because there are no more words")):i.utils.debug(2,d+"Cannot resume Text because it is null")},this.resetText=function(){this.pauseText(),u=null,lb.call(this),hb.call(this)},this.reset=function(){lb.call(this),hb.call(this),u&&u.hasNextWord()?tb():u.hasNextWord()||(C=e.completed,yb(c.placeholderText.endText,c.placeholderText.endTextColor))}}var i=a;!function(){d(),e()}(),c.addEventListener("spritz_loaded_internal",function(){if("SpritzSettings"in b&&"object"==typeof b.SpritzSettings)if(b.SpritzSettings.hasOwnProperty("clientId")){var a="https://api.spritzinc.com/api-server/v1/",d=location.href;b.SpritzSettings.hasOwnProperty("apiRoot")&&(a=b.SpritzSettings.apiRoot),b.SpritzSettings.hasOwnProperty("redirectUri")&&(d=b.SpritzSettings.redirectUri),"object"==typeof i&&"object"==typeof i.client&&(b.SpritzClient=new i.client.SpritzClient(b.SpritzSettings.clientId,a,d),b.SpritzSettings.hasOwnProperty("anonymousEnabled")&&"boolean"==typeof b.SpritzSettings.anonymousEnabled&&b.SpritzClient.setAnonymousEnabled(b.SpritzSettings.anonymousEnabled),"object"==typeof i.spritzinc&&("complete"===c.readyState?i.spritzinc.initSpritzers(b.SpritzClient):c.addEventListener("DOMContentLoaded",function(){i.spritzinc.initSpritzers(b.SpritzClient)})))}else console&&console.log("SpritzSettings is missing clientId property, skipping initialization")}),i.utils={},i.utils.debugLevel=0,i.utils.setDebugLevel=function(a){i.utils.debugLevel=a},i.namespace=function(a){var b,c=a.split("."),d=i;for("SPRITZ"===c[0]&&(c=c.slice(1)),b=0;b<c.length;b+=1)"undefined"==typeof d[c[b]]&&(d[c[b]]={}),d=d[c[b]];return d},i.addToNamespace=function(a,b){var c=b();for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])},i.utils.supportsCanvas=function(){return!!c.createElement("canvas").getContext()},i.utils.supportsCanvasText=function(){if(!i.utils.supportsCanvas())return!1;var a=c.createElement("canvas"),b=a.getContext("2d");return"function"==typeof b.fillText},i.utils.supportsHtmlStorage=function(){try{return"localStorage"in b&&null!==b.localStorage}catch(a){return!1}},i.utils.getBrowser=function(){return i.utils.isOpera()?"opr":i.utils.isChrome()?"chrome":i.utils.isFirefox()?"firefox":i.utils.isMsie()?"msie":i.utils.isSafari()?"safari":!1},i.utils.isChrome=function(){return b.navigator.userAgent.toLowerCase().indexOf("chrome")>-1},i.utils.isFirefox=function(){return b.navigator.userAgent.toLowerCase().indexOf("firefox")>-1},i.utils.isMsie=function(){var a=b.navigator.userAgent.toLowerCase();return a.indexOf("msie")>-1||a.indexOf("trident")>-1},i.utils.isOpera=function(){return b.navigator.userAgent.toLowerCase().indexOf("opr")>-1},i.utils.isSafari=function(){var a=b.navigator.userAgent.toLowerCase();return a.indexOf("chrome")<0&&a.indexOf("safari")>-1},i.utils.endsWith=function(a,b){return-1!==a.indexOf(b,a.length-b.length)},i.utils.timestampToString=function(a,b){"undefined"==typeof b&&(b=new Date);var c="",d=Math.round((b.getTime()-a)/1e3);if(60>d)c=d+"s ago";else{var e=Math.round((b.getTime()-a)/6e4);if(60>e)c=e+"m ago";else{var f,g,h=new Date(a);h.getHours()>12?(f=h.getHours()-12,g="PM"):(f=h.getHours(),g="AM");var i=f+":";h.getMinutes()<10&&(i+="0"),i=i+h.getMinutes()+" "+g,c=h.getDate()===b.getDate()&&h.getMonth()===b.getMonth()&&h.getFullYear()===b.getFullYear()?i:h.getMonth()+1+"/"+h.getDate()+"/"+h.getFullYear().toString().substring(2,4)+" "+i}}return c},i.utils.timeToString=function(a){var b,c=Math.round(a/1e3),d=c/60;if(d>=60){var e=Math.floor(d/60);d=Math.round(d%60),b=e+"hr"+(e>1?"s ":" ")+d+"m"}else d=Math.floor(d),c=Math.round(c%60),b=(d>0?d+"m ":"")+c+"s";return b},i.utils.debug=function(a){var c=[].slice.call(arguments).splice(1,arguments.length-1);if(b.console&&console.log){var d;switch(a){case 1:d="error";break;case 2:d="error";break;default:d="log"}if(a<=i.utils.debugLevel){for(var e="",f=0;f<c.length;f++)e+=c[f]+" ";console[d]||(d="log"),console[d](e)}}};var j=j||function(){var a=function(a,b){if("function"!=typeof b)throw new Error("method parameter is not a function ["+typeof b+"]");var c=function(){return b.apply(a,arguments)};return c},b=function(a){"complete"===c.readyState||"loaded"===c.readyState?a():c.addEventListener("DOMContentLoaded",a)};return{createDelegate:a,onDocumentReady:b}}();i.namespace("SPRITZ.constants"),i.addToNamespace(i.constants,function(){var a="spritzer",b="spritzer-control-",c={ROOT:a,BTN_BASE:b,BTN_PLAY:b+"play",BTN_PAUSE:b+"pause",BTN_PAUSEPLAY:b+"pauseplay",BTN_REWIND:b+"rewind",BTN_BACK:b+"back",BTN_FORWARD:b+"forward",BTN_END:b+"end",BTN_DISABLED:b+"disabled",BTN_CLOSE:a+"-close",BTN_LOGIN:a+"-login-btn",BTN_LOGOUT:a+"-logout-btn",USER:a+"-user",USER_BTN:a+"-user-btn",USER_LIST:a+"-user-list",USER_TEXT:a+"-user_text",LOGGEDIN:a+"-isLoggedin",LOGGEDOUT:a+"-isLoggedout",SPEED_BTN:a+"-speed-btn",SPEED_LIST:a+"-speed-list",SPEED_CONTAINER:a+"-speed",SPEED_TEXT:a+"-speed_text",DROPDOWN_BTN:a+"-dropdown-toggle",DROPDOWN_LIST:a+"-dropdown-menu",SELECTED:a+"-selected",OPEN:a+"-open",CARET:a+"-caret",DISABLED:a+"-disabled",CANVAS:a+"-canvas",CANVAS_CONTAINER:a+"-canvas-container",SPRITZER_CONTAINER:a+"-container",LOADING:a+"-loading"},d={MIN_SPEED:200,MAX_SPEED:450};return Object.freeze(d),{Constants:d,CSSClasses:c}}),i.namespace("SPRITZ.helper"),i.addToNamespace(i.helper,function(){function a(a,b,c,d){a.onload=function(){if(this.status>=200&&this.status<400)if("json"===b)try{c(JSON.parse(this.responseText))}catch(a){i.utils.debug(3,"JSON parse failed",a.message),d(a.message)}else c(this.responseText);else{var f=e(this);i.utils.debug(3,"status",this.status+", ["+f+"]"),d(f)}},a.onerror=function(){i.utils.debug(3,"status",this.status+", ["+this.statusText+"]"),d(this.statusText)},a.send()}function d(a,b,c,d,g,h){a.onreadystatechange=function(){if(4==this.readyState)if(this.status>=200&&this.status<400)if("json"===c)try{g(JSON.parse(this.responseText))}catch(a){i.utils.debug(3,"JSON parse failed",a.message),h(a.message)}else g(this.responseText);else{var b=e(this);i.utils.debug(3,"status",this.status+", ["+b+"]"),h(b)}},null!==d&&"object"==typeof d?(b?a.setRequestHeader("Content-Type",b):a.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),a.send(f(d))):(b&&a.setRequestHeader("Content-Type",b),a.send(d))}function e(a){var b;try{var c=JSON.parse(a.response);"object"==typeof c&&(b=c.message)}catch(d){}return a.statusText+(b?" ("+b+")":"")}function f(a){var b="";for(var c in a)a.hasOwnProperty(c)&&(b+=encodeURIComponent(c)+"="+encodeURIComponent(a[c]),b+="&");return b.length>0?b.substring(0,b.length-1):b}var g=i.utils.isMsie(),h=function(a){var b=c.createElement("BUTTON");return q(b,a),b.setAttribute("type","button"),b},j=function(a,b,d){var e=c.createElement("CANVAS");return q(e,a),e.width=b,e.height=d,e},k=function(a){var b=c.createElement("DIV");return q(b,a),b},l=function(a,b,d){var e=c.createElement("SPAN");return q(e,a),e.textContent=b?b:"",d&&e.setAttribute("value",d),e},m=function(a){var b=c.createElement("UL");return q(b,a),b},n=function(a,b,d){var e=c.createElement("LI");return q(e,a),e.textContent=b?b:"",d&&e.setAttribute("value",d),e},o=function(a,b){a&&(a.textContent=b?b:"")},p=function(a){var b=c.implementation.createHTMLDocument("");return b.body.innerHTML=a,b.body.children},q=function(a,b){if(null!==a)if(a.classList)if(b.constructor===Array)for(var c=0;c<b.length;c+=1)a.classList.add(b[c]);else a.classList.add(b);else if("[object NodeList]"===a)for(var c=0;c<a.length;c++)a[c].className+=b;else a.className+=" "+b},r=function(a,b){var c;if(null!==a)if(a.classList)c=a.classList.contains(b);else if("[object NodeList]"==a){c=!1;for(var d=0;d<a.length;d++){c=a[d].className+=b;break}}else c=new RegExp("(^| )"+b+"( |$)","gi").test(a.className);else c=!1;return c},s=function(a,b){if(null!==a)if(a.classList)a.classList.remove(b);else if("[object NodeList]"==a)for(var c=0;c<a.length;c++)a[c].className=a[c].className.replace(new RegExp("(^|\\b)"+b.split(" ").join("|")+"(\\b|$)","gi")," ");else a.className=a.className.replace(new RegExp("(^|\\b)"+b.split(" ").join("|")+"(\\b|$)","gi")," ")},t=function(a){null!==a&&(a.style.display="none")},u=function(a){null!==a&&(a.style.display="block")},v=function(a){var b;return b=null!==a?a.title:null},w=function(a,b){null!==a&&(a.title=b)},x=function(a,d,e,f){var h;e?b.CustomEvent&&!g?h=new CustomEvent(d,{detail:e}):(h=c.createEvent("CustomEvent"),h.initCustomEvent(d,!0,!0,e)):(h=c.createEvent("HTMLEvents"),h.initEvent(d,!0,!1)),f&&(h.source=f),a.dispatchEvent(h)},y=function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)c.hasOwnProperty(d)&&(null===c[d]?a[d]=null:"object"==typeof c[d]?c[d].constructor===Array?a[d]=c[d].slice(0):a[d]?y(a[d],c[d]):a[d]=y({},c[d]):a[d]=c[d])}return a},z=function(a){A(a.type,a.url,a.async,a.headers,a.contentType,a.dataType,a.data,a.success,a.error)},A=function(b,c,e,f,g,h,i,j,k){var l=new XMLHttpRequest;l.open(b,c,e);for(var m in f)f.hasOwnProperty(m)&&null!==f[m]&&l.setRequestHeader(m,f[m]);"GET"===b?a(l,h,j,k):d(l,g,h,i,j,k)};return{createButton:h,createCanvas:j,createDiv:k,createSpan:l,createUl:m,createLi:n,setSpanHtml:o,parseHTML:p,addClass:q,hasClass:r,removeClass:s,hide:t,show:u,getTitle:v,setTitle:w,dispatchEvent:x,extend:y,ajax:z}}),i.namespace("SPRITZ.spritzinc"),i.addToNamespace(i.spritzinc,function(){function a(c,d,e,f,g,h){return this instanceof a?(this.parentContainer=c,this.onChangeHandler=h,void b.call(this,d,e,f,g)):new a(c,d)}function b(a,b,c,g){this.selectBox=f.call(this,a,b,c,g),this.parentContainer.appendChild(this.selectBox),this.selectOptions.children.length>0&&(this.value=this.selectOptions.children[0].getAttribute("value"),this.selectValue.innerHTML=this.selectOptions.children[0].innerHTML),this.selectValue.addEventListener("click",d.bind(this)),this.selectArrow.addEventListener("click",d.bind(this));for(var h in this.options)if(this.options.hasOwnProperty(h)){var i=this.options[h];i.addEventListener("click",e.bind(this,i))}}function d(a){"none"===getComputedStyle(this.selectOptions).display?(j.show(this.selectOptions),a.dropdownMenuCreated=!0,this.outsideClickHandler=g.bind(this),c.addEventListener("click",this.outsideClickHandler)):j.hide(this.selectOptions)}function e(a){if(!j.hasClass(a,h.DISABLED)){j.hide(this.selectOptions);var b=a.getAttribute("value");b!=this.value&&(this.setSelected(b),j.setSpanHtml(this.selectValue,a.innerHTML))}}function f(a,b,c,d){var e=j.createDiv([h.DROPDOWN_BTN,b]);this.selectValue=j.createSpan(c),e.appendChild(this.selectValue),this.selectArrow=j.createSpan(h.CARET),e.appendChild(this.selectArrow),this.selectOptions=j.createUl([h.DROPDOWN_LIST,d]),j.hide(this.selectOptions),e.appendChild(this.selectOptions),this.options={};for(var f in a)if(a.hasOwnProperty(f)){var g=j.createLi("selectOption",a[f],f);this.options[f]=g,this.selectOptions.appendChild(g)}return e}function g(a){a.dropdownMenuCreated||(j.hide(this.selectOptions),c.removeEventListener("click",this.outsideClickHandler),this.outsideClickHandler=null)}var h=i.constants.CSSClasses,j=(i.constants.Constants,i.helper);return a.prototype.addOption=function(a){this.selectOptions.appendChild(a),this.options[a.getAttribute("value")]=a,a.addEventListener("click",e.bind(this,a))},a.prototype.getSelected=function(){return this.value},a.prototype.setSelected=function(a){var b,c=this.options[a];if(c){var d=this.options[this.value];d&&j.removeClass(d,h.SELECTED),j.addClass(c,h.SELECTED),a!==this.value&&(this.value=a,this.onChangeHandler&&this.onChangeHandler(a)),this.selectValue.innerHTML=c.innerHTML,b=!0}else b=!1;return b},a.prototype.restrict=function(a){var b,c=this.options[a];return c?(j.addClass(c,h.DISABLED),b=!0):b=!1,b},a.prototype.unrestrict=function(a){var b,c=this.options[a];return c?(j.removeClass(c,h.DISABLED),b=!0):b=!1,b},{DropDownSelect:a}}),i.namespace("SPRITZ.spritzinc"),i.addToNamespace(i.spritzinc,function(){function a(c,d){return this instanceof a?(this.parentContainer=c,this.options=d,void b.call(this)):new a(c,d)}function b(){if(this.options.speedItems.length>0){for(var a=c.call(this),b={},d=0,g=a.length;g>d;d+=1)b[a[d].toString()]=a[d]+" wpm";this.dropDownSelect=new i.spritzinc.DropDownSelect(this.parentContainer,b,f.SPEED_BTN,f.SPEED_TEXT,f.SPEED_LIST,e.bind(this))}}function c(){var a=this.options.speedItems.sort(function(a,b){return a-b});return a}function d(a){null!=this.parentContainer&&h.dispatchEvent(this.parentContainer,"speedChange",{speed:a})}function e(a){d.call(this,parseInt(a))}var f=i.constants.CSSClasses,g=i.constants.Constants,h=i.helper;return a.prototype.getSpeed=function(){return this.dropDownSelect?parseInt(this.dropDownSelect.getSelected()):void 0},a.prototype.setSpeed=function(a){var b;return b=this.dropDownSelect?this.dropDownSelect.setSelected(a.toString()):!1},a.prototype.restrict=function(){for(var a,b,d=c.call(this),e=0,f=d.length;f>e;e+=1)d[e]<g.MIN_SPEED?this.dropDownSelect.restrict(d[e]):(a||(a=d[e]),d[e]>g.MAX_SPEED?this.dropDownSelect.restrict(d[e]):b=d[e]);this.dropDownSelect.getSelected()<g.MIN_SPEED?this.dropDownSelect.setSelected(a):this.dropDownSelect.getSelected()>g.MAX_SPEED&&this.dropDownSelect.setSelected(b)},a.prototype.unrestrict=function(){for(var a=c.call(this),b=0,d=a.length;d>b;b+=1)(a[b]<g.MIN_SPEED||a[b]>g.MAX_SPEED)&&this.dropDownSelect.unrestrict(a[b])},{DropDownSpeedSelector:a}}),i.namespace("SPRITZ.model"),i.model.TimedWord=f,i.model.TimedWord.FLAG_MASK=7,i.model.TimedWord.FLAG_SENTENCE_START=1,i.model.TimedWord.FLAG_BOLD=2,i.model.TimedWord.FLAG_PARAGRAPH_START=4,f.prototype={isBold:function(){return 0!=(this.flags&this.model.TimedWord.FLAG_BOLD)},isSentenceStart:function(){return 0!=(this.flags&this.model.TimedWord.FLAG_SENTENCE_START)},isParagraphStart:function(){return 0!=(this.flags&this.model.TimedWord.FLAG_PARAGRAPH_START)},toString:function(){return'{"'+this.word+'", '+this.orp+", "+this.multiplier+", "+this.position+(this.isParagraphStart()?", paragraphStart":"")+(this.isSentenceStart()?", sentenceStart":"")+(this.isBold()?", bold":"")+"}"}},i.model.TelemetryItem=function(a,b,c,d,e,f,g,h,i,j,k,l){if(this.id=a,this.time=g,this.user=b,this.userType=c,this.sessionId=d,this.category="ContentView",this.name=h,this.data={viewingSessionId:e,contentVersionId:f,"char":i,speed:j},"undefined"!=typeof k&&(this.data.interrupted=k),"undefined"!=typeof l)for(var m in l)l.hasOwnProperty(m)&&(this.data[m]=l[m])},i.model.TelemetryBatch=function(a,b){this.clientOS=a,this.clientEvents=b},i.model.IllegalArgumentException=function(a){this.name="IllegalArgumentException",this.message=a},i.model.IllegalArgumentException.prototype=new Error,i.model.IllegalArgumentException.prototype.constructor=i.model.IllegalArgumentException,i.model.ArrayIndexOutOfBoundsException=function(a){this.name="ArrayIndexOutOfBoundsException",this.message=a},i.model.ArrayIndexOutOfBoundsException.prototype=new Error,i.model.ArrayIndexOutOfBoundsException.prototype.constructor=i.model.ArrayIndexOutOfBoundsException,i.namespace("SPRITZ.model"),i.model.SpritzText=g,g.prototype={applySpeedOverrides:function(a){for(var b=a.split(","),c=0;c<b.length;c++){var d=null,e=b[c].split(":");if(e.length<2)d="Invalid speed override value: "+b[c];else{var f=parseInt(e[0]),g=parseInt(e[1]);0>g&&(d="Invalid speed override value, negative multiplier, falling back to zero: "+b[c],g=0),0>f||f>=this.words.length?d="Invalid speed override value, word index out of bounds: "+b[c]:this.words[f].multiplier=g}null!==d&&console&&"function"==typeof console.log&&console.log(d)}},getContentVersionId:function(){return this.contentVersionId},setContentVersionId:function(a){this.contentVersionId=a},getDuration:function(){return this.duration},getWords:function(){return this.words},getLocale:function(){return this.locale},getVersion:function(){return this.version},getWord:function(a){return this.words[a]},getCurrentWord:function(){return this.words[this.index]},getNextWord:function(){if(this.words[this.index+1]){if(this.setCurrentIndex(++this.index),this.words[this.index]){var a=this.words[this.index];return a}return null}return null},hasNextWord:function(){return this.index<this.words.length-1},getCurrentIndex:function(){return this.index},setCurrentIndex:function(a){var b;return this.words[a]?(this.index=a,null!=this.progressTracker&&this.progressTracker(this.index+1,this.words.length),b=!0):b=!1,b},size:function(){return this.words.length},getWordCount:function(){return this.wordCount},isLoaded:function(){return this.words.length>0||this.words.length==this.wordCount},reset:function(){this.setCurrentIndex(0)},getPreviousSentenceStart:function(a,b){var c=i.model;if(0>a||a>=this.words.length)throw new c.ArrayIndexOutOfBoundsException(a);var d=a;if(b>0)for(;d>0&&b>0&&(!this.words[d].isSentenceStart()||0!=--b);d--);return d},getNextSentenceStart:function(a,b){var c=i.model;if(0>a||a>this.words.length)throw new c.ArrayIndexOutOfBoundsException(a);var d=a;if(b>0)for(;d<this.words.length&&(!this.words[d].isSentenceStart()||0!=--b);d++);return d},calculateTime:function(a,b){var c=0==this.words.length?this.wordCount:this.words.length,d=this.rawWordCount>0?this.rawWordCount:c;return 6e4*d/a*(c-b)/c},computeStandardDelay:function(a){var b=Math.round(this.rawWordCount/a*60*1e3);return Math.round(b/this.duration)},getTotalTime:function(a){return this.calculateTime(a,0)},getRemainingTime:function(a){return this.calculateTime(a,this.index)},getProgressTracker:function(){return this.progressTracker},setProgressTracker:function(a){this.progressTracker=a},seek:function(a,b){var c;return a>=0&&a<this.words.length?(c=!0,this.setCurrentIndex(b===this.seekType.ABSOLUTE?a:b===this.seekType.SENTENCE_START?this.getPreviousSentenceStart(a,1):a)):c=!1,c},clone:function(){var a=new i.model.SpritzText(this.contentVersionId,this.words,this.duration,this.wordCount,this.rawWordCount,this.locale,this.version);return a.contentId=this.contentId,a.setProgressTracker(this.progressTracker),a}},i.model.SpritzText.SeekType=Object.freeze({ABSOLUTE:"absolute",SENTENCE_START:"sentenceStart"}),i.model.SpritzText.autoIdCounter=0,i.model.SpritzText.make=function(a){if("object"==typeof a){if(a.content){var b=a.content[0];return i.model.SpritzText.create(b.id,b.sd0,b.sd1,b.sd2,b.duration,b.rawWordCount)}return i.model.SpritzText.create(a.plainTextHash,a.sd0,a.sd1,a.sd2,a.duration,a.rawWordCount)}},i.model.SpritzText.create=function(a,b,c,d,e,f){var g=i.model,h="V2",j="AAAC",k=l.math.Long.fromInt(1073741823),m=l.math.Long.fromInt(15),n=l.math.Long.fromInt(16383),o=l.math.Long.fromInt(7),p=1,q=2,r=4;if(b!==h)throw new Error("Unknown container format");if(!("object"==typeof c&&c instanceof Array&&"object"==typeof d&&d instanceof Array))throw new Error("Invalid data format: wrong types");if(0==d.length)throw new Error("Invalid data format: data2");var s=d[0];if("string"!=typeof s)throw new g.IllegalArgumentException("Invalid preamble");var t=s.split(",");if(t.length<4)throw new Error("Invalid preamble");if(t[0]!=j)throw new Error("Unrecognized encoding");var u=parseInt(t[1]),v=[],w=0,x=0;if(0==c.length){if(1!=d.length)throw new Error("Invalid data format: Wrong data length")}else if(c.length!=u||d.length-1!=u)throw new Error("Invalid data format: Wrong data length");for(var y=0;y<c.length;y++){var z=c[y],A=d[y+1],B=l.math.Long.fromString(A,16),C=B.and(o).toInt(),D=0;0!=(C&p)&&(D|=g.TimedWord.FLAG_BOLD),0!=(C&q)&&(D|=g.TimedWord.FLAG_SENTENCE_START),0!=(C&r)&&(D|=g.TimedWord.FLAG_PARAGRAPH_START),B=B.shiftRight(3);var E=B.and(n).getLowBits();B=B.shiftRight(14);var F=B.and(m).getLowBits();B=B.shiftRight(4);var G=B.and(k).getLowBits();v.push(new g.TimedWord(z,F,E,G,D)),w=w+1+E/100,""!==z&&x++}return("undefined"==typeof e||null===e)&&(e=w),f||(f=x),new i.model.SpritzText(a,v,e,u,f,t[2],t[3])},i.model.SpritzText.createFromContainerV2=function(a,b){var c;return c="object"==typeof b.sdRaw?i.model.SpritzText.createFromFlashV1(a,b.sdRaw):i.model.SpritzText.create(a,b.sd0,b.sd1,b.sd2,null,null)},i.model.SpritzText.createFromFlashV1=function(a,b){for(var c=b.Locale,d=b.EngineVersion,e=new Array(b.Words.length),f=0,g=0,h=0;h<b.Words.length;h++){var j=b.Words[h],k=0;null!==j.Flags&&(-1!==j.Flags.indexOf("bold")&&(k|=i.model.TimedWord.FLAG_BOLD),-1!==j.Flags.indexOf("sentenceStart")&&(k|=i.model.TimedWord.FLAG_SENTENCE_START),-1!==j.Flags.indexOf("paragraphStart")&&(k|=i.model.TimedWord.FLAG_PARAGRAPH_START)),""!==j.Segment&&g++,e[h]=new i.model.TimedWord(j.Segment,j.ORP,j.Multiplier,j.CharPosition,k),f=f+1+j.Multiplier/100}return new i.model.SpritzText(a,e,f,e.length,g,c,d)},i.model.SpritzText.createFromString=function(a){var b,c=JSON.parse(a),d="spritzText"+i.model.SpritzText.autoIdCounter++;if("string"!=typeof c.sd0)throw new Error("Unable to parse data, missing container version field");if("V2"===c.sd0)b=i.model.SpritzText.createFromContainerV2(d,c);else{if("Flash1"!==c.sd0)throw new Error("Unable to parse data, unsupported container version: "+c.sd0);b=i.model.SpritzText.createFromFlashV1(d,c)}return b};var k=function(){function a(a,d){for(var e=0,f=a.length;f>e;++e)!function(e){function f(){return g&&g.offsetWidth!==h&&(++b,g.parentNode.removeChild(g),g=null),b>=a.length&&(i&&clearInterval(i),b===a.length)?(d(),!0):void 0}var g=c.createElement("span");g.innerHTML="giItT1WQy@!-/#",g.style.position="absolute",g.style.left="-10000px",g.style.top="-10000px",g.style.fontSize="300px",g.style.fontFamily="sans-serif",g.style.fontVariant="normal",g.style.fontStyle="normal",g.style.fontWeight="normal",g.style.letterSpacing="0",c.body.appendChild(g);var h=g.offsetWidth;g.style.fontFamily=e;var i=0;f()||(i=setInterval(f,50))}(a[e])}var b=0;return function(c,d){c.length>b?a(c,d):d()}}();i.namespace("SPRITZ.client"),i.addToNamespace(i.client,function(){var a={name:"Spritz_JSSDK",version:"2.0.0",buildDate:"Wed Feb 11 2015 17:13:43 GMT-0700 (MST)"};return{VersionInfo:a}}),i.namespace("SPRITZ.client"),i.addToNamespace(i.client,function(){function a(){return"Microsoft Internet Explorer"===navigator.appName||"Netscape"===navigator.appName&&null!==new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(navigator.userAgent)}function c(a,b){this.code=a,this.message=b}function d(a,b,c){this.url=b+"/oauth/authorize?c="+encodeURIComponent(i.client.VersionInfo.name+"_"+i.client.VersionInfo.version)+"&response_type=token&client_id="+a+"&redirect_uri="+encodeURIComponent(c),this.onSuccess=null,this.onError=null,this.storageHandler=new i.datastore.StorageHandler}var e=function(a){"function"==typeof b.removeEventListener?(b.removeEventListener("message",this.onMessageHandler,!1),i.utils.debug(3,"Registered listener via addEventListener")):b.detachEvent("onmessage",this.onMessageHandler),this.storageHandler.remove("authResponse"),this.onSuccess&&this.onSuccess(a.data),this.showing=!1,a.source.close()};return d.prototype.show=function(c,d){this.onSuccess=c,this.onError=d,i.utils.debug(3,"opening auth popup with URL: ",this.url),this.storageHandler.remove("authResponse");var f=b.open(this.url,"SpritzLogin","width=400,height=400,location=0,menubar=0,toolbar=0");if(f){f.focus(),this.showing=!0,this.onMessageHandler=j.createDelegate(this,e),"function"==typeof b.addEventListener?(b.addEventListener("message",this.onMessageHandler,!1),i.utils.debug(3,"Registered listener via addEventListener")):b.attachEvent("onmessage",this.onMessageHandler);var g=a(),h=this,k=null;k=setInterval(function(){var a=h.storageHandler.getString("authResponse");if(null!==a&&h.onMessageHandler({data:a,source:f}),g)try{f.name&&-1!==f.name.indexOf("#access_token")&&h.onMessageHandler({data:f.name,source:f})}catch(b){i.utils.debug(2,b)}h.showing&&f?f.closed&&(clearInterval(k),h.showing=!1,h.onError&&h.onError(new Error("Login aborted"))):clearInterval(k)},250)}else i.utils.debug(1,"SpritzClient: Unable to open auth popup."),this.onError&&this.onError(new Error("Popup unable to open."))},{APIError:c,AuthPopup:d}}),i.addToNamespace(i.client,function(){function a(a){return"string"==typeof a&&'"'===a.charAt(0)&&'"'===a.charAt(a.length-1)&&(a=a.substr(1,a.length-2)),a}function b(a,b,c){this.clientId=a,this.apiRoot=b,this.redirectUri=c,this.initialized=!1,this.clientAccessToken=null,this.guestAccessToken=null,this.userAccessToken=null,this.apiHost=null,this.anonymousEnabled=!1,this.loginCallback=null,this.logoutCallback=null,this.storageHandler=new i.datastore.StorageHandler,h.call(this),g.call(this),this.clientAccessToken=v.call(this,"client"),this.guestAccessToken=v.call(this,"guest"),this.userAccessToken=v.call(this,"user"),this.registry={loginStateChanged:[]}
}var c=i.helper,d=Object.freeze({USER_ID:"userId",USER_NAME:"userName",GUEST_ID:"guestId"}),e=function(a){var b={};if(null===a||0===a.length)return b;var c=a.indexOf("#");c>=0&&(a=a.substring(c+1));for(var d=a.split("&"),e=0;e<d.length;e++){var f,g,h=d[e],i=h.indexOf("=");-1===i?(f=decodeURIComponent(h),g=!0):(f=decodeURIComponent(h.substring(0,i)),g=decodeURIComponent(h.substring(i+1))),b[f]=g}return b},f=function(a,b,c){return b+"Token."+a+"."+c},g=function(){var a=this.apiRoot.indexOf("//");if(-1===a)this.apiHost="api.spritzinc.com";else{var b=this.apiRoot.indexOf("/",a+2);this.apiHost=-1===b?this.apiRoot.substring(a+2):this.apiRoot.substring(a+2,b)}},h=function(){"/"===this.apiRoot.substring(this.apiRoot.length-1)&&(this.apiRoot=this.apiRoot.substring(0,this.apiRoot.length-1))},j=function(a){var b;return(403===a.status||500===a.status)&&(b=k(a.responseJSON)),new i.client.APIError(a.status,"HTTP call failed, status: "+a.status+", message: "+a.statusText+(b?" ["+b+"]":""))},k=function(a){var b;try{b=" ["+a.code+"/"+a.message+"]"}catch(c){b="",i.utils.debug(2,c)}return b},l=function(a,b){var d=this,e=function(c){"access_token"in c&&"token_type"in c&&"bearer"===c.token_type?"function"==typeof a&&q.call(d,c.access_token,a,b):"function"==typeof b&&b(new Error("Client login failed, invalid response"))},f=function(a){var c=j.call(d,a);if(403===c.code&&(i.utils.debug(2,"Client ID "+d.clientId+" is not authorized to use anonymous mode"),d.anonymousEnabled=!1),"function"==typeof b){var e=new Error("Unable to perform client login: "+c.message);e.cause=c,b(e)}};c.ajax({type:"GET",url:this.apiRoot+"/oauth/clientToken?clientId="+encodeURIComponent(this.clientId),dataType:"json",async:!0,success:e,error:f})},m=function(a,b){var e=this,f=function(c){"userid"in c&&"token"in c?c.audience===e.clientId?(e.storageHandler.putString(d.GUEST_ID,c.userid),y.call(e,c.token),a()):"function"==typeof b&&b(new Error("clientId mismatch")):"function"==typeof b&&b(new Error("Guest login failed, invalid response"))},g=function(a){var c=j.call(e,a);if(403===c.code&&(i.utils.debug(1,"Client ID "+e.clientId+" is not authorized to use anonymous mode"),e.anonymousEnabled=!1),"function"==typeof b){var d=new Error("Unable to perform guest login: "+c.message);d.cause=c,b(d)}};c.ajax({type:"GET",url:this.apiRoot+"/oauth/guestToken?clientId="+encodeURIComponent(this.clientId),xhrFields:{withCredentials:!0},dataType:"json",async:!0,success:f,error:g})},n=function(a,b,c,d,e){var f=this,g=1,h={url:a},j=!0;"undefined"!=typeof b&&(h.selector=b,h.selectorType="undefined"==typeof c?"CSS":c);var k=function(){f.execute({type:"POST",contentType:"application/json",url:"/content",dataType:"json",async:!0,data:JSON.stringify(h)},j,!0,function(a){d&&d(a)},function(a){!j&&"code"in a&&403===a.code&&1===g?(i.utils.debug(2,"Content retrieval in anonymous failed with 403, retrying with userRequired=true"),g++,j=!0,k()):"function"==typeof e&&e(new Error("Content retrieval failed: "+a.message))})};k()},o=function(a,b,c,d,e,f){var g=!0;this.execute({type:"GET",url:"/contentVersion?includeSpritzableText="+b+"&includePlainText="+c+"&sortColumn=createdDate&sortDirection=DESC&pageSize=1&contentId="+encodeURIComponent(a),dataType:"json",async:!0},g,!0,function(g){if(0===g.content.length)f&&f(new Error("No contentVersion returned"));else{var h=g.content[0];if(e){var j,k;if(d){var l=i.model.SpritzText.make(g);c&&(l.plainText=h.plainText),b||(l.contentId=a),j=l,k=g.media}else j={id:h.id,duration:h.duration,locale:h.locale,sd0:h.sd0,sd1:h.sd1,sd2:h.sd2,sd3:h.sd3,sd4:h.sd4},k=h.media;e(j,k)}}},function(b){f&&f(new Error("Unable to retrieve contentVersion, contentId="+a+": "+b.message))})},p=function(a,b){var c=null;try{this.initialized=!0}catch(d){c=d}null===c?a&&a():"function"==typeof b&&b(new Error("Initialization failed: "+c.message))},q=function(a,b){w.call(this,a),"function"==typeof b&&b(a)},r=function(a,b,c){var d=e(a);d.access_token&&d.token_type?"bearer"===d.token_type?z.call(this,d.access_token,b,c):this.onError&&this.onError(new Error("Unexpected token type: "+d.token_type)):this.onError&&this.onError(new Error("No token data in response"))},s=function(a,b){x.call(this,a),b&&b(a),this.loginCallback&&this.loginCallback()},t=function(a){this.storageHandler.remove(f(this.apiHost,a,this.clientId))},u=function(a,b){this.storageHandler.putString(f(this.apiHost,a,this.clientId),b)},v=function(a){return this.storageHandler.getString(f(this.apiHost,a,this.clientId))},w=function(a){if(this.clientAccessToken=a,null===a)t.call(this,"client");else try{u.call(this,"client",a)}catch(b){i.utils.debug(1,"Error with localStorage: ",b)}},x=function(a){if(this.userAccessToken=a,null===a)t.call(this,"user");else try{u.call(this,"user",a)}catch(b){i.utils.debug(1,"Error with localStorage: ",b)}},y=function(a){if(this.guestAccessToken=a,null===a)t.call(this,"guest");else try{u.call(this,"guest",a)}catch(b){i.utils.debug(1,"Error with localStorage: ",b)}},z=function(a,b,e){var f=function(a){e&&e(new Error("Token validation failed: "+a.message+" Please make sure you are not using Internet Explorer 9 or less, as Spritz is unsupported in those browsers."))},g=this;c.ajax({type:"GET",url:this.apiRoot+"/oauth/tokeninfo?access_token="+encodeURIComponent(a),dataType:"json",async:!0,success:function(c){c.audience===g.clientId?(g.storageHandler.putString(d.USER_ID,c.userid),g.storageHandler.putString(d.USER_NAME,c.username),s.call(g,a,b,e)):f(new Error("clientId mismatch"))},error:f})};b.prototype.execute=function(a,b,e,f,g){var h,k,n=null,o=1,q=this;if(a.url=this.apiRoot+a.url,h=function(){i.utils.debug(3,"Invoking "+a.type+" "+a.url);var b=function(a){if(401===a.status&&1===o)o++,"user"===n?(q.storageHandler.remove(d.USER_ID),q.storageHandler.remove(d.USER_NAME),x.call(q,null)):"guest"===n?(q.storageHandler.remove(d.GUEST_ID),y.call(q,null)):"client"===n&&w.call(q,null),k();else{var b=j(a);g?g(b):i.utils.debug(1,b.code+": "+b.message)}};"user"===n?a.headers={Authorization:"Bearer "+q.userAccessToken}:"guest"===n?a.headers={Authorization:"Bearer "+q.guestAccessToken}:"client"===n&&(a.headers={Authorization:"Bearer "+q.clientAccessToken}),a.success=f,a.error=b,c.ajax(a)},k=function(){if(b||null!==q.userAccessToken||null!==q.guestAccessToken)if(b)if(null!==q.userAccessToken)n="user",h();else if(e)if(n="guest",null===q.guestAccessToken){var a=function(a){g&&g(new Error("API call failed, guest login failed: "+a.message))};m.call(q,h,a)}else h();else g&&g(new Error("No user login and no guest allowed"));else n=q.userAccessToken?"user":"guest",h();else if(n="client",null===q.clientAccessToken){var c=function(a){"cause"in a&&a.cause instanceof i.client.APIError&&403===a.cause.code?(i.utils.debug(2,"Client login failed with status 403, retrying API call with userRequired"),b=!0,k()):g&&g(new Error("API call failed, client login failed: "+a.message))};l.call(q,h,c)}else h()},q.initialized)k();else{var r=function(a){g&&g(new Error("Execution failed, unable to get accessToken: "+a.message))};p.call(q,k,r)}},b.prototype.userLogin=function(a,b){var c=new i.client.AuthPopup(this.clientId,this.apiRoot,this.redirectUri),d=this,e=function(){a(),A.call(d,"loginStateChanged",{state:"login"})},f=function(a){r.call(d,a,e,b)},g=function(a){"function"==typeof b&&b(new Error("Login Failed: "+a.message))};c.show(f,g)},b.prototype.userLogout=function(){this.storageHandler.remove(d.USER_ID),this.storageHandler.remove(d.USER_NAME),x.call(this,null),this.logoutCallback&&this.logoutCallback();try{A.call(this,"loginStateChanged",{state:"logout"})}catch(a){i.utils.debug(1,'Failed to raise "loginStateChanged" event ['+a.message+"]")}},b.prototype.fetchContents=function(a,b,c,d,e){var f=this,g=function(a){o.call(f,a.id,!0,!1,!0,b,c)};n.call(this,a,d,e,g,c)},b.prototype.fetchContents2=function(a,b,c,d){var e,f,g,h,i,j=this;"undefined"==typeof d?(e=!0,f=null,g=null,h=!1,i=!0):(e="undefined"==typeof d.decode?!0:d.decode,f="undefined"==typeof d.selector?null:d.selector,g="undefined"==typeof d.selectorType?"CSS":d.selectorType,h="undefined"==typeof d.includePlainText?!1:d.includePlainText,i="undefined"==typeof d.includeSpritzableText?!0:d.includeSpritzableText);var k=function(a){o.call(j,a.id,i,h,e,b,c)};n.call(this,a,f,g,k,c)},b.prototype.fetchContentsByContentId=function(a,b,c,d){var e,f,g;"undefined"==typeof d?(e=!0,f=!1,g=!0):(e="undefined"==typeof d.decode?!0:d.decode,f="undefined"==typeof d.includePlainText?!1:d.includePlainText,g="undefined"==typeof d.includeSpritzableText?!0:d.includeSpritzableText),o.call(this,a,g,f,e,b,c)},b.prototype.isUserLoggedIn=function(){return"string"==typeof this.userAccessToken&&this.userAccessToken.length>0},b.prototype.setAuthResponse=function(a,b,c){r.call(this,a,b,c)},b.prototype.spritzify=function(a,b,c,d){this.execute({type:"POST",url:"/misc/spritzify",dataType:"json",async:!0,data:{plainText:a,locale:b}},!0,!0,function(a){try{var b=i.model.SpritzText.make(a);"function"==typeof c&&c(b)}catch(e){"function"==typeof d&&d(new Error("Invalid data received: "+e.message))}},function(a){if("function"==typeof d){var b;b="undefined"!=typeof a.message?a.message:a.status+" ["+a.statusText+"]",d(new Error("Unable to retrive spritzableText: "+b))}})},b.prototype.sendTelemetry=function(a,b,c){var d=a.clientEvents[0].user,e="g"===a.clientEvents[0].userType?"guest":"user",f="g"===a.clientEvents[0].userType;this.execute({type:"POST",contentType:"application/json",url:"/"+e+"/"+d+"/event",dataType:"json",async:!0,data:JSON.stringify(a)},!0,f,function(c){"function"==typeof b&&b(a,c)},function(b){if("function"==typeof c){var d;d="undefined"!=typeof b.message?b.message:b.status+" ["+b.statusText+"]",c(a,new Error("Unable to send Telemetry: "+d))}})},b.prototype.setAnonymousEnabled=function(a){this.anonymousEnabled=a===!0},b.prototype.getGuestId=function(){var b=this.storageHandler.getString(d.GUEST_ID);if(b){var c=a(b);b!==c&&(this.setGuestId(c),b=c)}return b},b.prototype.setGuestId=function(a){this.storageHandler.putString(d.GUEST_ID,a)},b.prototype.getUserId=function(){var b=this.storageHandler.getString(d.USER_ID);if(b){var c=a(b);b!==c&&(this.setUserId(c),b=c)}return b},b.prototype.setUserId=function(a){this.storageHandler.putString(d.USER_ID,a)},b.prototype.getUserName=function(){return this.storageHandler.getString(d.USER_NAME)},b.prototype.setUserName=function(a){this.storageHandler.putString(d.USER_NAME,a)},b.prototype.registerLoginCallback=function(a){"function"==typeof a&&(this.loginCallback=a)},b.prototype.registerLogoutCallback=function(a){"function"==typeof a&&(this.logoutCallback=a)},b.prototype.on=function(a,b){if("undefined"==typeof this.registry[a])i.utils.debug(1,"Unsupported event: "+a);else{var c=this.registry[a],d=c.indexOf(b);-1===d?c.push(b):i.utils.debug(1,"Already registered for "+a)}},b.prototype.off=function(a,b){if("undefined"==typeof this.registry[a])i.utils.debug(1,"Unsupported event: "+a);else{var c=this.registry[a],d=c.indexOf(b);-1===d?i.utils.debug(1,"Not registered for "+a):c.splice(d,1)}};var A=function(){var a=arguments[0];if(!this.registry.hasOwnProperty(a))throw new Error("Unsupported event: "+a);for(var b=this.registry[a],c=Array.prototype.slice.call(arguments,1,arguments.length),d=0;d<b.length;d++)b[d].apply(null,c)};return{SpritzClient:b}}),i.namespace("SPRITZ.datastore"),i.addToNamespace(i.datastore,function(){function a(a){this.prefix="undefined"==typeof a?"spritz.":a}a.prototype.bulkUpdate=function(a,f,g){"undefined"==typeof f&&(f=e);for(var h=0,j=b.call(this,a),k=0;k<localStorage.length;k++){var l=localStorage.key(k);if(0===l.indexOf(j)){var m=c(localStorage.getItem(l));f(m)&&(g(m),localStorage.setItem(l,d(m)),h++)}}return i.utils.debug(3,"StorageHandler: Bulk updated "+h+" item(s)"),h},a.prototype.count=function(a,d){"undefined"==typeof d&&(d=e);for(var f=b.call(this,a),g=0,h=0;h<localStorage.length;h++){var i=localStorage.key(h);if(0===i.indexOf(f)){var j=c(localStorage.getItem(i));d(j)&&g++}}return g},a.prototype.get=function(a){var d=localStorage.getItem(b.call(this,a));return null==d?(i.utils.debug(2,"StorageHandler: Item ["+a+"] does not exist"),null):c(d)},a.prototype.getDate=function(a){var c,d=localStorage.getItem(b.call(this,a));return c=null===d||""===d?null:new Date(d)},a.prototype.getString=function(a){return localStorage.getItem(b.call(this,a))},a.prototype.put=function(a,c){localStorage.setItem(b.call(this,a),d(c))},a.prototype.putDate=function(a,c){localStorage.setItem(b.call(this,a),null===c?"":c.toISOString())},a.prototype.putString=function(a,c){localStorage.setItem(b.call(this,a),c)},a.prototype.remove=function(a){for(var c=0,d=b.call(this,a),e=0,f=localStorage.length;f>e;e+=1){var g=localStorage.key(e);null!=g&&0==g.indexOf(d)&&(localStorage.removeItem(g),c+=1)}return c},a.prototype.select=function(a,d,f){"undefined"==typeof d&&(d=e),"undefined"==typeof f&&(f=Number.MAX_VALUE);for(var g=0,h=0,j=[],k=b.call(this,a);g<localStorage.length&&j.length<f;g++){var l=localStorage.key(g);if(0===l.indexOf(k)){h++;var m=c(localStorage.getItem(l));d(m)&&j.push(m)}}return i.utils.debug(3,"StorageHandler: Select returning "+j.length+" item(s) after scanning "+g+" keys and inspecting "+h+" item(s)"),j};var b=function(a){return this.prefix+a},c=function(a){try{return JSON.parse(a)}catch(b){return i.utils.debug(2,"StorageHandler: Failed to parse item, exception ["+b.name+"] msg["+b.message+"]"),i.utils.debug(2,"StorageHandler: Item is not JSON - returning the raw value: ["+a+"]"),a}},d=function(a){return JSON.stringify(a)},e=function(){return!0};return{StorageHandler:a,composeKey:b}}),i.namespace("SPRITZ.display"),i.addToNamespace(i.display,function(){function a(a,b,c){this.name="dp"+Math.random(),e[this.name]=new h(a,b),this.client=c,this.telemetryHandler=new i.spritzinc.TelemetryHandler(c),this.storageHandler=this.telemetryHandler.storageHandler,this.onCompleteCallback=function(a){this.telemetryHandler.stop(e[this.name].getCurrentText(),e[this.name].getCurrentTextSpeed()),"function"==typeof a&&a()}}function b(a){return null!=e[this.name].getCurrentText()&&(this.telemetryHandler.changeSpeed(e[this.name].getCurrentText(),e[this.name].getCurrentTextSpeed(),a),e[this.name].isRunning()&&this.telemetryHandler.start(e[this.name].getCurrentText(),a)),e[this.name].setCurrentTextSpeed(a),a}function c(a){var b=a.getCurrentIndex();if(b>=0){var c;a.hasNextWord()?c=2:(b--,c=1),b=a.getPreviousSentenceStart(b,c),""==a.getWord(b).word&&b<a.size()-1&&(b+=1)}return b}function d(a){var b=a.getCurrentIndex();return b<a.size()-1&&(b=a.getNextSentenceStart(b+1,1)),b}var e={},f=i.constants.Constants;return a.prototype.reloadRedicle=function(a,b){e[this.name]=new h(a,b)},a.prototype.getCurrentText=function(){return e[this.name].getCurrentText()},a.prototype.setCurrentText=function(a){e[this.name].getCurrentText()&&this.telemetryHandler.stop(e[this.name].getCurrentText(),e[this.name].getCurrentTextSpeed()),e[this.name].setCurrentText(a),this.telemetryHandler.viewStart(e[this.name].getCurrentText(),e[this.name].getCurrentTextSpeed())},a.prototype.getCurrentTextSpeed=function(){return e[this.name].getCurrentTextSpeed()},a.prototype.setCurrentTextSpeed=function(a){var c=null===this.client||!(this.client.isUserLoggedIn()||this.client.anonymousEnabled),a=parseInt(a);if("number"!=typeof a)return i.utils.debug(2,"setSpeed accepts only numbers, you passed in: ",a,typeof a),!1;if(a%1!==0&&(a=Math.round(a)),c){var d=this.storageHandler.get("speedMinMax");if((void 0===d||null===d)&&(d={min:f.MIN_SPEED,max:f.MAX_SPEED}),a>d.max||a<d.min){var e=a>d.max?"faster than maxUnregistered ["+d.max+"]":"slower than minUnregistered ["+d.min+"]";return i.utils.debug(0,"Attempt to set speed ["+a+"] "+e+" failed"),!1}return b.call(this,a)}return b.call(this,a)},a.prototype.getCurrentPosition=function(){return null!=this.getCurrentText()?this.getCurrentText().getCurrentIndex():-1},a.prototype.setCurrentPosition=function(a){null!=this.getCurrentText()&&(e[this.name].isRunning()&&this.telemetryHandler.pause(e[this.name].getCurrentText(),e[this.name].getCurrentTextSpeed()),e[this.name].setCurrentPosition(a))},a.prototype.getHighlightBestLetter=function(){return e[this.name].getHighlightBestLetter()},a.prototype.setHighlightBestLetter=function(a){e[this.name].setHighlightBestLetter(a)},a.prototype.getOnCompleteCallback=function(){return e[this.name].getOnCompleteCallback()},a.prototype.setOnCompleteCallback=function(a){e[this.name].setOnCompleteCallback(this.onCompleteCallback.bind(this,a))},a.prototype.isPaused=function(){return e[this.name].isPaused()},a.prototype.isReady=function(){return e[this.name].isReady()},a.prototype.isRunning=function(){return e[this.name].isRunning()},a.prototype.isCompleted=function(){return e[this.name].isCompleted()},a.prototype.displayText=function(a,b){e[this.name].getCurrentText()&&this.telemetryHandler.stop(e[this.name].getCurrentText(),e[this.name].getCurrentTextSpeed()),e[this.name].displayText(a,this.onCompleteCallback.bind(this,b)),this.telemetryHandler.viewStart(e[this.name].getCurrentText(),e[this.name].getCurrentTextSpeed()),this.telemetryHandler.start(e[this.name].getCurrentText(),e[this.name].getCurrentTextSpeed())},a.prototype.pauseText=function(){e[this.name].isRunning()&&this.telemetryHandler.pause(e[this.name].getCurrentText(),e[this.name].getCurrentTextSpeed()),e[this.name].pauseText()},a.prototype.resumeText=function(a){(e[this.name].isReady()||e[this.name].isPaused())&&this.telemetryHandler.start(e[this.name].getCurrentText(),e[this.name].getCurrentTextSpeed()),e[this.name].resumeText(a)},a.prototype.resetUser=function(){this.pauseText(),this.telemetryHandler.resetUser()},a.prototype.resetText=function(){null!=e[this.name].getCurrentText()&&(e[this.name].pauseText(),this.telemetryHandler.stop(e[this.name].getCurrentText(),e[this.name].getCurrentTextSpeed()),e[this.name].resetText())},a.prototype.goToFirstWord=function(){this.getCurrentText()&&(e[this.name].pauseText(),this.telemetryHandler.rewind(this.getCurrentText(),e[this.name].getCurrentTextSpeed()),this.getCurrentText().reset(),e[this.name].reset())},a.prototype.goToPreviousSentence=function(){this.getCurrentText()&&(e[this.name].pauseText(),this.telemetryHandler.backup(this.getCurrentText(),e[this.name].getCurrentTextSpeed()),this.getCurrentText().setCurrentIndex(c(this.getCurrentText())),e[this.name].reset())},a.prototype.goToNextSentence=function(){var a=this.getCurrentText();if(a){e[this.name].pauseText(),this.telemetryHandler.forward(a,e[this.name].getCurrentTextSpeed());var b=a.setCurrentIndex(d(a));if(b||a.setCurrentIndex(a.size()-1),e[this.name].reset(),!a.hasNextWord()){var c=e[this.name].getOnCompleteCallback();c&&this.onCompleteCallback(c)}}},a.prototype.seek=function(a,b){var c,d=this.getCurrentText();return d?d.seek(a,b)?(e[this.name].pauseText(),this.telemetryHandler.seek(this.getCurrentText(),e[this.name].getCurrentTextSpeed()),e[this.name].reset(),c=!0):(i.utils.debug(2,name+"SpritzText.seek() failed"),c=!1):(i.utils.debug(2,name+"Cannot seek because text is null"),c=!1),c},a.prototype.getCurrentState=function(){return e[this.name].getCurrentState()},a.prototype.setCurrentState=function(a){return e[this.name].setCurrentState(a)},a.prototype.goToEnd=function(){var a=this.getCurrentText();if(a){e[this.name].pauseText(),this.telemetryHandler.end(this.getCurrentText(),e[this.name].getCurrentTextSpeed()),a.setCurrentIndex(a.size()-1),e[this.name].reset();var b=e[this.name].getOnCompleteCallback();b&&this.onCompleteCallback(b)}else i.utils.debug(2,"SpritzDisplayProxy: no text loaded")},a.prototype.eraseWord=function(){return e[this.name].eraseWord()},a.prototype.displayPlaceholderText=function(a,b){return e[this.name].displayPlaceholderText(a,b)},a.prototype.setRedicle=function(a){e[this.name]=a},{SpritzDisplayProxy:a}}),i.namespace("SPRITZ.spritzinc"),i.addToNamespace(i.spritzinc,function(){function a(a){this.client=a,this.userAgent=navigator.userAgent,this.sessionId=o(),this.viewingSessionId=null,this.contentVersionId=null,this.items=[],this.eventId=0,this.storageHandler=new i.datastore.StorageHandler,this.startTime=(new Date).getTime(),this.updateTime=this.startTime,this.inactivityTimeout=null,this.userId=null,this.userType=null,this.started=!1,this.batchDelay=v.BATCH_DELAY,b.call(this),p.call(this,this.startTime)}function b(){this.userType=null,null!==this.client&&(this.userId=this.client.getUserId(),null!==this.userId?this.userType="u":(this.userId=this.client.getGuestId(),null!==this.userId&&(this.userType="g")))}function c(){this.inactivityTimeout=setTimeout(j.createDelegate(this,e),v.BATCH_TIMEOUT)}function d(){null!==this.inactivityTimeout&&(clearTimeout(this.inactivityTimeout),this.inactivityTimeout=null)}function e(){i.utils.debug(3,"Processing inactivity timeout with ["+this.items.length+"] item(s)"),this.items.length>0&&f.call(this)}function f(){d.call(this),g.call(this,this.items),this.items=[],this.startTime=(new Date).getTime()}function g(a){var b=new i.model.TelemetryBatch(this.userAgent,a);this.client.sendTelemetry(b,j.createDelegate(this,h),j.createDelegate(this,k))}function h(a,b){var c=a.clientEvents[0].sessionId,d=a.clientEvents[0].data.contentVersionId;b.length<a.clientEvents.length&&i.utils.debug(2,"Failed to process ["+(a.clientEvents.length-b.length)+"] item(s)");for(var e=0,f=b.length;f>e;e+=1)0===this.storageHandler.remove(l(c,d,b[e]))&&i.utils.debug(2,"Failed to remove item ["+b[e]+"]")}function k(a,b){i.utils.debug(2,"Failed to send batch ["+b.message+"]"),s.call(this,a.clientEvents)}function l(a,b,c){return v.TELEMETRY_KEY+"."+a+"."+b+"."+c}function m(a){return"undefined"==typeof a?new Date:a}function n(a){return(new Date).getTime()-a}function o(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"===a?b:3&b|8;return c.toString(16)})}function p(a){for(var b="",c="",d="",e=r.call(this,a),f=[],g=[],h=0,i=e.length;i>h;h+=1){var j=e[h];(j.user!==b||j.sessionId!==c||j.data.contentVersionId!==d||g.length>=v.BATCH_SIZE)&&(g.length>0&&(f.push(g),g=[]),b=j.user,c=j.sessionId,d=j.data.contentVersionId),g.push(j)}g.length>0&&f.push(g),f.length>0&&q.call(this,f)}function q(a){var b=a[0];b[0].user===this.getUserId()?g.call(this,b):s.call(this,b),a.length>1&&(a.splice(0,1),this.batchDelay>0?setTimeout(j.createDelegate(this,function(){q.call(this,a)}),this.batchDelay):q.call(this,a))}function r(a){for(var b=this.storageHandler.select(v.TELEMETRY_KEY).sort(t),c=b.length-1;c>=0;c--){var d=b[c],e="Date"==typeof d.time?d.time:new Date(d.time);e.getTime()>=a&&b.splice(c,1)}return b}function s(a){for(var b=0,c=a.length;c>b;b+=1){var d=a[b];n(new Date(d.time).getTime())>v.HOLDING_PERIOD&&0===this.storageHandler.remove(l(d.sessionId,d.data.contentVersionId,d.id))&&i.utils.debug(2,"Failed to remove item ["+d+"]")}}function t(a,b){var c;return c=a.user>b.user?1:a.user<b.user?-1:a.sessionId>b.sessionId?1:a.sessionId<b.sessionId?-1:a.data.contentVersionId>b.data.contentVersionId?1:a.data.contentVersionId<b.data.contentVersionId?-1:a.id>b.id?1:a.id<b.id?-1:a.time>b.time?1:a.time<b.time?-1:0}var u=Object.freeze({VIEW_START:"SpritzViewStart",START:"SpritzStart",STOP:"SpritzStop",PAUSE:"SpritzPause",BACKUP:"SpritzBackup",FORWARD:"SpritzForward",REWIND:"SpritzRewind",SEEK:"SpritzSeek",SPEED:"SpritzSpeed",GOTOEND:"SpritzEnd"}),v=Object.freeze({ANONYMOUS:"anonymous",TELEMETRY_KEY:"telemetry",BATCH_SIZE:50,BATCH_TIMEOUT:6e4,BATCH_DELAY:1e4,HOLDING_PERIOD:6048e5});return a.prototype.resetUser=function(){this.items.length>0&&f.call(this),this.userId=null,this.userType=null},a.prototype.viewStart=function(a,b){this.checkPreviousContent(a),this.viewingSessionId=o(),this.contentVersionId=a.getContentVersionId(),this.items=[];var c=new Date;this.startTime=c.getTime(),this.storeEvent(u.VIEW_START,a,b,c),this.started=!0},a.prototype.start=function(a,b){this.checkPreviousContent(a),this.storeEvent(u.START,a,b),this.started=!0},a.prototype.stop=function(a,b){this.started&&(this.storeEvent(u.STOP,a,b,void 0,a.hasNextWord()),this.started=!1),this.items.length>0&&f.call(this)},a.prototype.pause=function(a,b){this.checkPreviousContent(a),this.storeEvent(u.PAUSE,a,b),this.started=!0},a.prototype.backup=function(a,b){this.checkPreviousContent(a),this.storeEvent(u.BACKUP,a,b),this.started=!0},a.prototype.forward=function(a,b){this.checkPreviousContent(a),this.storeEvent(u.FORWARD,a,b),this.started=!0},a.prototype.rewind=function(a,b){this.checkPreviousContent(a),this.storeEvent(u.REWIND,a,b),this.started=!0},a.prototype.end=function(a,b){this.checkPreviousContent(a),this.storeEvent(u.GOTOEND,a,b),this.started=!0},a.prototype.seek=function(a,b){this.checkPreviousContent(a),this.storeEvent(u.SEEK,a,b),this.started=!0},a.prototype.changeSpeed=function(a,b,c){this.checkPreviousContent(a),this.storeEvent(u.SPEED,a,b,void 0,void 0,{newSpeed:c}),this.started=!0},a.prototype.checkPreviousContent=function(a){this.items.length>0&&(null!==this.contentVersionId&&this.contentVersionId!==a.getContentVersionId()||n(this.startTime)>=v.BATCH_TIMEOUT)&&f.call(this)},a.prototype.storeEvent=function(a,b,e,g,h,j){if(null!==this.getUserId()&&null!==this.client){d.call(this),this.eventId+=1;var k=b.hasNextWord()?b.getCurrentWord().position:-1,n=l(this.sessionId,this.contentVersionId,this.eventId),o=new i.model.TelemetryItem(this.eventId,this.getUserId(),this.userType,this.sessionId,this.viewingSessionId,this.contentVersionId,m(g),a,k,e,h,j);i.utils.debug(3,"Added item: "+JSON.stringify(o)),this.storageHandler.put(n,o),this.items.push(o),this.updateTime=(new Date).getTime(),this.items.length>=v.BATCH_SIZE&&f.call(this),c.call(this)}},a.prototype.getUserId=function(){return null===this.userId&&b.call(this),this.userId},{TelemetryHandler:a,batchTimeout:v.BATCH_TIMEOUT,batchSize:v.BATCH_SIZE,holdingPeriod:v.HOLDING_PERIOD,EventTypeEnum:u,submitPendingItems:p,sendBatchSuccess:h,sendBatchFailure:k}}),i.namespace("SPRITZ.template"),i.addToNamespace(i.template,function(){function a(a){var b=a;return b.match(/{{\s*[\w\.]+\s*}}/g).map(function(a){var c=a.match(/[\w\.]+/)[0];f[c]||i.utils.debug(1,"Can't find constant: ",f[c]),b=b.replace(new RegExp(a,"g"),f[c])}),b}function b(b){var c="";return c+=d(b),c+=a('<div id="{{LOADING}}"></div>'),c+='<div class="spritzer-preloaded spritzer-btn-pause"></div>'}function c(b){var c="";return c+='<div class="spritzer-controls-container">',c+=a('<div class="{{SPEED_CONTAINER}}" data-role="select"></div>'),c+=e(b),c+='<div class="spritzer-force-font" style="font-family:SpritzMedienMedium">.</div>',c+="</div>"}function d(b){var c='<div class="spritzer-header">';return c+='<a class="spritzer-logo" href="http://www.spritzinc.com" target="_blank"></a>',b.header.login&&(c+=a('<a class="{{BTN_LOGIN}} {{LOGGEDIN}}">Login</a>'),c+=a('<div class="{{USER}}"></div>')),b.header.close&&(c+='<span class="spritzer-close">&#215</span>'),c+="</div>"}function e(a){var b="";b+='<div class="spritzer-preload spritzer-btn-pause">a</div>',b+='<div class="spritzer-button-container spritzer-btns-'+a.controlButtons.length+'">';for(var c=0,d=a.controlButtons.length;d>c;c+=1){var e=a.controlButtons[c],f=a.controlTitles[e];b+='<div class="spritzer-control-'+e+'" title="'+f+'"></div>'}return b+="</div>"}{var f=i.constants.CSSClasses;i.constants.Constants}return{buildHtml1:b,buildHtml2:c,interpolate:a}}),i.namespace("SPRITZ.spritzinc"),i.addToNamespace(i.spritzinc,function(){function a(c,e){return this instanceof a?(this.spritzClient=e?e:b.SpritzClient||null,this.loading=!1,this.container=null,this.parentContainer=null,this.spritzPanel=null,this.pausePlayBtn=null,this.rewindBtn=null,this.backBtn=null,this.forwardBtn=null,this.pauseTitle=null,this.playTitle=null,this.progressReporter=null,this.seekPosition=null,this.seekMode=null,this.playOnFetchSuccess=!1,this.speedSelector=null,this.defaults=W,this.options,f.call(this,c),void d.call(this)):new a(c,e)}function d(){var a=this,b=this.options;this.container=e(b);var c=this.container.querySelector("."+U.CANVAS_CONTAINER);c.addEventListener("redicleClick",j.createDelegate(this,t)),null===this.spritzPanel?this.spritzPanel=new i.display.SpritzDisplayProxy(c,b,a.spritzClient):this.spritzPanel.reloadRedicle(c,b),this.pausePlayBtn=this.container.querySelector("."+U.BTN_PAUSEPLAY),this.rewindBtn=this.container.querySelector("."+U.BTN_REWIND),this.backBtn=this.container.querySelector("."+U.BTN_BACK),this.forwardBtn=this.container.querySelector("."+U.BTN_FORWARD),this.endBtn=this.container.querySelector("."+U.BTN_END),b.header.close&&(this.closeBtn=this.container.querySelector("."+U.BTN_CLOSE),b.header.closeHandler&&(b.header.closeHandler=j.createDelegate(a,b.header.closeHandler)),this.closeBtn.addEventListener("click",b.header.closeHandler||this.hideSpritzer.bind(a)));for(var d={pauseplay:l,rewind:m,back:n,forward:o,end:p,redicle:t},f=(b.controlButtons,0),g=b.controlButtons.length;g>f;f+=1)this.container.querySelector("."+U.BTN_BASE+b.controlButtons[f]).addEventListener("click",j.createDelegate(this,d[b.controlButtons[f]]));var h=this.container.querySelector("."+U.SPEED_CONTAINER);if("DropDown"===b.speedSelector?this.speedSelector=new i.spritzinc.DropDownSpeedSelector(h,b):i.utils.debug(1,"Invalid speedSelector specified ["+b.speedSelector+"]"),this.speedSelector&&(M()||this.speedSelector.restrict(),h.addEventListener("speedChange",j.createDelegate(this,v))),this.progressReporter=j.createDelegate(this,N),O.call(this),I.call(this,!1),this.pauseTitle=b.controlTitles.pause,this.playTitle=b.controlTitles.play,b.header.login){this.container.querySelector("."+U.BTN_LOGIN).addEventListener("click",j.createDelegate(this,q));var k=this.container.querySelector("."+U.USER),u=new i.spritzinc.DropDownSelect(k,{},U.USER_BTN,U.USER_TEXT,U.USER_LIST),w=V.createLi(U.BTN_LOGOUT,"Logout");u.addOption(w),w.addEventListener("click",j.createDelegate(this,s)),P.call(this,SpritzClient.isUserLoggedIn())}a.spritzClient&&null!==a.spritzClient&&a.spritzClient.on("loginStateChanged",r.bind(this));var x=this.speedSelector.getSpeed()||b.defaultSpeed;this.setSpeed(x)}function e(a){for(var b=V.createDiv(U.SPRITZER_CONTAINER),c=V.parseHTML(i.template.buildHtml1(a));c.length>0;)b.appendChild(c[0]);for(b.appendChild(V.createDiv(U.CANVAS_CONTAINER)),c=V.parseHTML(i.template.buildHtml2(a));c.length>0;)b.appendChild(c[0]);return b}function f(a,b){var c=V.extend({},this.defaults);if(b===!0&&(c=this.getOptions()||this.defaults),a&&"object"==typeof a){if(this.options=V.extend({},c,a),i.utils.setDebugLevel(this.options.debugLevel),a&&a.redicle){var d=V.extend(c.redicle,a.redicle);this.options.redicle=d}if(a.redicle&&(a.redicle.redicleLineWidth&&!this.options.redicle.crossHairWidth&&(this.options.redicle.crossHairWidth=a.redicle.redicleLineWidth),a.redicle.redicleLineColor&&!this.options.redicle.crossHairColor&&(this.options.redicle.crossHairColor=a.redicle.redicleLineColor)),a&&a.placeholderText){var e=V.extend(c.placeholderText,a.placeholderText);this.options.placeholderText=e}}else this.options=c;return this.options}function g(){this.responsiveAttached=!0,this.onResize(function(a){var b=this,c=function(a,c){b.applyOptions({redicleWidth:Math.round(a),redicleHeight:Math.round(c)},!0)},d=a.containerWidth-a.redicleWidth,e=a.windowWidth-d;a.windowWidth<=a.containerWidth?c(e,e*a.aspectRatio):a.windowWidth>a.containerWidth&&e<=a.originalRedicleWidth&&c(e,e*a.aspectRatio)},"resize.spritzInternal")}function h(a){V.hide(this.container.querySelector("#"+U.LOADING)),this.loading=!1,V.removeClass(this.pausePlayBtn,U.BTN_DISABLED),null!==this.seekPosition&&a.seek(this.seekPosition,this.seekMode),this.playOnFetchSuccess?(this.startSpritzing(a),O.call(this,!0),I.call(this,!0)):this.setSpritzText(a),i.utils.isSafari()&&this.applyOptions(this.options),this.playOnFetchSuccess=!1}function k(a){V.hide(this.container.querySelector("#"+U.LOADING)),this.loading=!1,V.removeClass(this.pausePlayBtn,U.BTN_DISABLED),this.playOnFetchSuccess=!1,i.utils.debug(1,"Unable to spritz: "+a.message)}function l(){var a=L(this.pausePlayBtn);
if(null==this.spritzPanel.getCurrentText())a&&T.call(this)&&this.loadText(!0);else if(a)if(this.spritzPanel.isPaused()||this.spritzPanel.isReady()){var b=this.spritzPanel.getCurrentText();b&&0===b.getCurrentIndex()&&E.call(this),O.call(this,!0),this.resumeSpritzing()}else this.spritzPanel.pauseText(),O.call(this),I.call(this,!1),x.call(this,this.pauseTitle)}function m(){if(L(this.rewindBtn)){this.spritzPanel.isRunning()&&x.call(this,this.pauseTitle);var a=this.spritzPanel.getCurrentPosition();this.spritzPanel.goToFirstWord(),O.call(this),I.call(this,!1),y.call(this,a)}}function n(){if(L(this.backBtn)){this.spritzPanel.isRunning()&&x.call(this,this.pauseTitle);var a=this.spritzPanel.getCurrentPosition();this.spritzPanel.goToPreviousSentence(),O.call(this),I.call(this,!1),z.call(this,a)}}function o(){if(L(this.forwardBtn)){this.spritzPanel.isRunning()&&x.call(this,this.pauseTitle);var a=this.spritzPanel.getCurrentPosition();this.spritzPanel.goToNextSentence(),O.call(this),I.call(this,!1),A.call(this,a)}}function p(){if(L(this.endBtn)){this.spritzPanel.isRunning()&&x.call(this,this.pauseTitle);var a=this.spritzPanel.getCurrentPosition();this.spritzPanel.goToEnd(),O.call(this),I.call(this,!1),B.call(this,a)}}function q(){this.spritzPanel.resetUser(),this.spritzClient.userLogin(function(){i.utils.debug(3,"Login success")},function(a){i.utils.debug(1,"Login failure ["+a+"]")})}function r(){P.call(this,this.spritzClient.isUserLoggedIn()),O.call(this),I.call(this,!1),H.call(this,this.spritzClient.isUserLoggedIn()?"login":"logout")}function s(){this.spritzPanel.resetUser(),this.spritzClient.userLogout()}function t(){if(null==this.spritzPanel.getCurrentText())L(this.pausePlayBtn)&&T.call(this)&&this.loadText(!0);else if(L(this.pausePlayBtn)&&this.spritzPanel.getCurrentText().hasNextWord())if(this.spritzPanel.isPaused()||this.spritzPanel.isReady()){var a=this.spritzPanel.getCurrentText();a&&0===a.getCurrentIndex()&&E.call(this),this.resumeSpritzing(),O.call(this,!0)}else this.spritzPanel.pauseText(),O.call(this),I.call(this,!1),C.call(this,this.pauseTitle);else this.spritzPanel.goToFirstWord(),this.resumeSpritzing(),O.call(this,!0)}function u(){O.call(this),I.call(this,!1),D.call(this)}function v(a){var b=a.detail.speed;b&&(this.spritzPanel.setCurrentTextSpeed(b),F.call(this))}function w(a,b){var c={position:this.spritzPanel.getCurrentPosition()};"undefined"!=typeof b&&(c.pausePosition=b),null!=this.parentContainer&&V.dispatchEvent(this.parentContainer,"onSpritz"+a,c)}function x(a){w.call(this,a)}function y(a){w.call(this,"Rewind",a)}function z(a){w.call(this,"Back",a)}function A(a){w.call(this,"Forward",a)}function B(a){w.call(this,"GoToEnd",a)}function C(a){w.call(this,a)}function D(){null!=this.parentContainer&&V.dispatchEvent(this.parentContainer,"onSpritzComplete")}function E(){null!=this.parentContainer&&V.dispatchEvent(this.parentContainer,"onSpritzStart")}function F(){null!=this.parentContainer&&V.dispatchEvent(this.parentContainer,"onSpritzSpeedChange",{speed:this.spritzPanel.getCurrentTextSpeed()})}function G(a){null!=this.parentContainer&&V.dispatchEvent(this.parentContainer,"onSpritzProgressChange",{percentComplete:a})}function H(a){null!=this.parentContainer&&V.dispatchEvent(this.parentContainer,"onSpritzAuthStateChange",{state:a},this.spritzClient)}function I(a){a?(V.removeClass(this.pausePlayBtn,U.BTN_PLAY),V.addClass(this.pausePlayBtn,U.BTN_PAUSE),V.setTitle(this.pausePlayBtn,"Pause")):(V.removeClass(this.pausePlayBtn,U.BTN_PAUSE),V.addClass(this.pausePlayBtn,U.BTN_PLAY),V.setTitle(this.pausePlayBtn,"Play"))}function J(a){return a.jquery&&(a=a[0]),a.SpritzerController}function K(a){var b=c.querySelectorAll('[data-role="spritzer"]');Array.prototype.forEach.call(b,function(b){var c=b.getAttribute("data-options");if(c)try{c=JSON.parse(c),"object"!=typeof c&&(c=null)}catch(d){i.utils.debug(2,"Failed to parse options ["+d.message+"]"),c=null}else c=null;var e=new i.spritzinc.SpritzerController(c,a);e.attach(b)})}function L(a){return!V.hasClass(a,U.BTN_DISABLED)}function M(){return SpritzClient?SpritzClient.isUserLoggedIn()||SpritzClient.anonymousEnabled:(i.utils.debug(2,"No SpritzClient defined."),!1)}function N(a,b){var c=100*a,d=c/b;100>=b?G.call(this,d):100>c%b&&G.call(this,d)}function O(a){null==this.spritzPanel.getCurrentText()||0==this.spritzPanel.getCurrentText().getWords().length?(T.call(this)&&this.hasSource()?V.removeClass(this.pausePlayBtn,U.BTN_DISABLED):V.addClass(this.pausePlayBtn,U.BTN_DISABLED),V.addClass(this.rewindBtn,U.BTN_DISABLED),V.addClass(this.backBtn,U.BTN_DISABLED),V.addClass(this.forwardBtn,U.BTN_DISABLED),V.addClass(this.endBtn,U.BTN_DISABLED)):a||this.spritzPanel.getCurrentPosition()>0&&this.spritzPanel.getCurrentText().hasNextWord()?(V.removeClass(this.pausePlayBtn,U.BTN_DISABLED),V.removeClass(this.rewindBtn,U.BTN_DISABLED),V.removeClass(this.backBtn,U.BTN_DISABLED),V.removeClass(this.forwardBtn,U.BTN_DISABLED),V.removeClass(this.endBtn,U.BTN_DISABLED)):0==this.spritzPanel.getCurrentPosition()?(V.removeClass(this.pausePlayBtn,U.BTN_DISABLED),V.addClass(this.rewindBtn,U.BTN_DISABLED),V.addClass(this.backBtn,U.BTN_DISABLED),V.removeClass(this.forwardBtn,U.BTN_DISABLED),V.removeClass(this.endBtn,U.BTN_DISABLED)):this.spritzPanel.getCurrentText().hasNextWord()||(V.addClass(this.pausePlayBtn,U.BTN_DISABLED),V.removeClass(this.rewindBtn,U.BTN_DISABLED),V.removeClass(this.backBtn,U.BTN_DISABLED),V.addClass(this.forwardBtn,U.BTN_DISABLED),V.addClass(this.endBtn,U.BTN_DISABLED))}function P(a){var b=this.container.querySelector("."+U.BTN_LOGIN),c=this.container.querySelector("."+U.USER_BTN);V.removeClass(b,a?U.LOGGEDOUT:U.LOGGEDIN),V.addClass(b,a?U.LOGGEDIN:U.LOGGEDOUT),V.removeClass(c,a?U.LOGGEDIN:U.LOGGEDOUT),V.addClass(c,a?U.LOGGEDOUT:U.LOGGEDIN),a?V.setSpanHtml(this.container.querySelector("."+U.USER_TEXT),SpritzClient.getUserName()):V.setSpanHtml(this.container.querySelector("."+U.USER_TEXT),""),Q.call(this)}function Q(){M()?this.speedSelector.unrestrict():this.speedSelector.restrict()}function R(a){return this.parentContainer.getAttribute("data-"+a)}function S(a,b){return this.parentContainer.setAttribute("data-"+a,b)}function T(){var a;return this.parentContainer&&(a="spritzer"===R.call(this,"role")?!0:!1),a}var U=i.constants.CSSClasses,V=(i.constants.Constants,i.helper),W={debugLevel:1,redicleWidth:340,redicleHeight:70,responsive:!1,responsiveDebounce:50,defaultSpeed:250,speedItems:[250,300,350,400,450,500,550,600],speedSelector:"DropDown",header:{login:!0,close:!1,closeHandler:null},controlButtons:["rewind","back","pauseplay","forward"],controlTitles:{pause:"Pause",play:"Play",rewind:"Back to Beginning",back:"Previous Sentence",forward:"Next Sentence",end:"Go to End"},placeholderText:{startText:"Click to spritz",startTextColor:"#bababa",endText:"",endTextColor:"#bababa"},redicle:{sizeable:!0,loadFonts:!0,fontName:"SpritzMedienMedium",backgroundColor:"#ffffff",textNormalPaintColor:"#333",textHighlightPaintColor:"#cc0001",redicleLine:!0,redicleLineColor:"#000",redicleLineWidth:1,crossHair:!0,crossHairColor:"#000",crossHairWidth:1,crossHairHeight:.1,crossHairHorizontalPosition:.35,countdownTime:750,countdownSlice:5,countdownColor:"rgba(0,0,0,0.1)"}};return a.prototype.attach=function(a){return a.jquery&&(a=a[0]),this.parentContainer=a,V.hasClass(a,U.ROOT)||V.addClass(a,U.ROOT),a.appendChild(this.container),a.SpritzerController=this,this.spritzClient&&this.hasSource()&&T.call(this)&&(I.call(this,!1),V.removeClass(this.pausePlayBtn,U.BTN_DISABLED)),P.call(this,SpritzClient.isUserLoggedIn()),this.options.responsive&&!this.responsiveAttached&&(b.removeEventListener("resize.spritzInternal"),g.call(this)),this},a.prototype.detach=function(){var a=this.parentContainer;return a.removeChild(this.container),a.SpritzerController=null,this.parentContainer=null,a},a.prototype.hasSource=function(){var a;if(null===this.spritzPanel.getCurrentText()){var b=this.getUrl();a=null===b||"undefined"==typeof b||b.length>0}else a=!0;return a},a.prototype.loadText=function(a,b){var c;if(!this.spritzClient||this.loading)c=!1;else{this.spritzPanel.isRunning()&&this.pauseSpritzing(),b||(b={});var d=this.getUrl()||b.url,e=R.call(this,"selector")||b.selector,f=R.call(this,"selectortype")||b.selectorType;d||(d=location.href),0==d.length?c=!1:(this.loading=!0,V.addClass(this.pausePlayBtn,U.BTN_DISABLED),this.playOnFetchSuccess=a,V.show(this.container.querySelector("#"+U.LOADING)),this.spritzClient.fetchContents(d,h.bind(this),k.bind(this),e,f),c=!0)}return c},a.prototype.getSpritzText=function(){return this.spritzPanel.getCurrentText()},a.prototype.setSpritzText=function(a){null===a?(O.call(this,!1),null!=this.spritzClient&&this.hasSource()&&(I.call(this,!0),V.removeClass(this.pausePlayBtn,U.BTN_DISABLED))):(null==a.getProgressTracker()&&a.setProgressTracker(this.progressReporter),this.spritzPanel.setCurrentText(a),this.spritzPanel.setOnCompleteCallback(j.createDelegate(this,u)),O.call(this,!1))},a.prototype.getUrl=function(){return R.call(this,"url")},a.prototype.setUrl=function(a,b,c){if(this.parentContainer){var d=this.getUrl();d&&d===a||(this.spritzPanel.resetText(),S.call(this,"url",a),"number"==typeof b?(this.seekPosition=b,this.seekMode="undefined"==typeof c?i.model.SpritzText.SeekType.SENTENCE_START:c===i.model.SpritzText.SeekType.SENTENCE_START||c===i.model.SpritzText.SeekType.ABSOLUTE?c:null):this.seekPosition=null,O.call(this,!1),this.spritzClient&&this.hasSource()&&(I.call(this,!1),V.removeClass(this.pausePlayBtn,U.BTN_DISABLED)))}else i.utils.debug(1,"setUrl() failed. No parent container set for the controller. Make sure you have attached the controller to an element in the DOM first.")},a.prototype.startSpritzing=function(a){this.spritzPanel.pauseText(),!a&&this.spritzPanel.getCurrentText()?this.spritzPanel.resumeText(!0):a&&(null==a.getProgressTracker()&&a.setProgressTracker(this.progressReporter),this.spritzPanel.displayText(a,j.createDelegate(this,u))),O.call(this,!0),I.call(this,!0),E.call(this)},a.prototype.stopSpritzing=function(){w.call(this,"Stop"),this.spritzPanel.resetText(),O.call(this),I.call(this,!1)},a.prototype.pauseSpritzing=function(){this.spritzPanel.pauseText(),I.call(this,!1),x.call(this,this.pauseTitle)},a.prototype.resumeSpritzing=function(){this.spritzPanel.resumeText(),I.call(this,!0),x.call(this,this.playTitle)},a.prototype.getSpeed=function(){return this.spritzPanel.getCurrentTextSpeed()},a.prototype.setSpeed=function(a){var b=this.spritzPanel.setCurrentTextSpeed(a);return b&&this.speedSelector&&this.speedSelector.setSpeed(b),b},a.prototype.getHighlightBestLetter=function(){return this.spritzPanel.getHighlightBestLetter()},a.prototype.setHighlightBestLetter=function(a){this.spritzPanel.setHighlightBestLetter(a)},a.prototype.getProgressReporter=function(){return this.progressReporter},a.prototype.setProgressReporter=function(a){this.progressReporter=a},a.prototype.seek=function(a,b){var c;return this.spritzPanel.seek(a,b)?(O.call(this),I.call(this,!1),c=!0):c=!1,c},a.prototype.setButtonState=function(a,b){b?a.removeClass(U.BTN_DISABLED):a.addClass(U.BTN_DISABLED)},a.prototype.adjustButtonStates=function(a){O.call(this,"undefined"==typeof a?this.spritzPanel.isRunning():a)},a.prototype.adjustPausePlayButton=function(a){I.call(this,"undefined"==typeof a?this.spritzPanel.isRunning():a)},a.prototype.showSpritzer=function(){this.container.style.display=""},a.prototype.hideSpritzer=function(){this.pauseSpritzing(),this.container.style.display="none"},a.prototype.applyOptions=function(a,b){var c=this.container,e=this.spritzPanel.getCurrentText(),g=this.spritzPanel.getOnCompleteCallback(),h=this.spritzPanel.getCurrentTextSpeed(),i=this.spritzPanel.getHighlightBestLetter(),j=this.spritzPanel.getCurrentState(),k=this.spritzPanel.isRunning();k&&this.spritzPanel.pauseText();var l=this.parentContainer,m=this.getProgressReporter();f.call(this,a,b),d.call(this),this.setProgressReporter(m),this.spritzPanel.setOnCompleteCallback(g),this.spritzPanel.setCurrentTextSpeed(h),this.spritzPanel.setHighlightBestLetter(i),this.speedSelector&&this.speedSelector.setSpeed(h,!0),c.parentNode&&c.parentNode.removeChild(c),this.attach(l),k||this.spritzPanel.setCurrentState(j),e&&this.spritzPanel.setCurrentText(e),k&&this.spritzPanel.resumeText(!1),O.call(this,k),I.call(this,k)},a.prototype.getProp=function(a){var b=a.split("."),c=this.options[b[0]];return this.options[b[0]]?(b.length>1&&(c=this.options[b[0]][b[1]]),c):void i.utils.debug(2,"SpritzOptions: the "+a+" property does not exist.")},a.prototype.getOptions=function(){return this.options||i.utils.debug(2,"SpritzOptions: no options initialized yet."),this.options},a.prototype.onResize=function(a,c){var d=this,e=this.options.redicleWidth,f=this.options.redicleHeight,g=c||"resize.spritz",h=function(){return{aspectRatio:d.options.redicleHeight/d.options.redicleWidth,originalRedicleWidth:e,originalRedicleHeight:f,redicleWidth:d.options.redicleWidth,redicleHeight:d.options.redicleHeight,containerWidth:d.parentContainer.width(),containerHeight:d.parentContainer.height(),windowWidth:b.offsetWidth,windowHeight:b.offsetHeight()}},i=function(){var b;return function(){b||(b=setTimeout(function(){b=null,a.call(d,h())},d.options.responsiveDebounce))}};a&&"function"==typeof a&&(this.parentContainer&&a.call(d,h()),b.addEventListener(g,i()))},{SpritzerController:a,initSpritzers:K,adjustPausePlayButton:I,setButtonStates:O,getSpritzerController:J,init:d}}),i.namespace("SPRITZ.bookmark"),i.addToNamespace(i.bookmark,function(){function a(a,c){this.spritzerController=a,this.bookStores=null,this.currentBookStore=null,this.currentChapterName=null,this.options=null,b.call(this,c)}function b(a){this.options=F(a),this.bookStores=d.call(this,this.spritzerController)}function d(a){for(var b={},d=c.querySelectorAll(this.options.book),f=0,k=d.length;k>f;f+=1){var l=d[f],m=l.querySelector(this.options.bookTitle),s=h(m.querySelector(this.options.bookName)),u=m.querySelector(this.options.totalTime),v=m.querySelector(this.options.remainingTime),w=new i.bookmark.BookStore(s,g(u,v));b[s]=w,e.call(this,l,w);var x=a.parentContainer;x.addEventListener("onSpritzPause",j.createDelegate(this,n)),x.addEventListener("onSpritzRewind",j.createDelegate(this,q)),x.addEventListener("onSpritzBack",j.createDelegate(this,o)),x.addEventListener("onSpritzForward",j.createDelegate(this,p)),x.addEventListener("onSpritzComplete",j.createDelegate(this,r)),x.addEventListener("onSpritzSpeedChange",j.createDelegate(this,t))}return b}function e(a,b){for(var d=c.querySelectorAll(this.options.bookChapter),e=0,i=d.length;i>e;e+=1){var j=d[e],l=j.getAttribute("data-url"),m=j.getAttribute("data-selector"),n=j.querySelector(this.options.statusImage),o=j.querySelector(this.options.chapterName),p=h(o),q=j.querySelector(this.options.totalTime),r=j.querySelector(this.options.remainingTime),s=f(l,m),t=g(q,r,n,o);b.addChapter(p,s,t),k.call(this,b,p,s,t),n.addEventListener("click",u.bind(this,b,p)),o.addEventListener("click",v.bind(this,b,p))}}function f(a,b){return{url:a,selector:b}}function g(a,b,c,d){return{totalTime:a,remainingTime:b,bookmarkElement:c,chapterElement:d}}function h(a){var b=a.getAttribute("data-name");return("undefined"==typeof b||null===b||""===b)&&(b=a.textContent),b}function k(a,b,c){var d=this,e=function(e){i.utils.debug(3,"BookController.onFetchInfoSuccess: "+e.getWordCount()+", "+e.getDuration()),c.text=e,y.call(d,a,b)},f=function(a){i.utils.debug(1,"BookController.onFetchInfoError: "+a.message)};SpritzClient.fetchContents2(c.url,e,f,{selector:c.selector,selectorType:"CSS",includePlainText:!1,includeSpritzableText:!1})}function l(a,b,c){var d=function(d){i.utils.debug(3,"BookController.fetchTextAndStartSpritzing"),c.text=d,m.call(this,a,b,c)},e=function(a){i.utils.debug(1,"BookController.fetchTextAndStartSpritzing: "+a.message)};SpritzClient.fetchContentsByContentId(c.text.contentId,j.createDelegate(this,d),e)}function m(a,b,c){null!=this.currentBookStore&&null!=this.currentChapterName&&G.removeClass(this.currentBookStore.getControls(this.currentChapterName).chapterElement,this.options.textHighlighter),G.addClass(a.getControls(b).chapterElement,this.options.textHighlighter),this.currentBookStore=a,this.currentChapterName=b;var d=c.text.clone(),e=a.getPosition(b);null!==e&&d.setCurrentIndex(e),d.hasNextWord()?this.spritzerController.startSpritzing(d):this.spritzerController.setSpritzText(d)}function n(a){s.call(this,a.detail.position)}function o(a){s.call(this,a.detail.position)}function p(a){s.call(this,a.detail.position)}function q(a){s.call(this,a.detail.position)}function r(){this.currentBookStore.setCompleted(this.currentChapterName),y.call(this,this.currentBookStore,this.currentChapterName)}function s(a){var b=this.spritzerController.getSpritzText().getPreviousSentenceStart(a,1);this.currentBookStore.setPosition(this.currentChapterName,b),y.call(this,this.currentBookStore,this.currentChapterName)}function t(a){i.utils.debug(3,"BookController.onSpeedChange");var b=a.detail.speed;for(var c in this.bookStores)if(this.bookStores.hasOwnProperty(c)){var d=this.bookStores[c];z(this.bookStores[c],b);for(var e in d.getChapters())A(d,e,b)}}function u(a,b){i.utils.debug(3,"BookController.onBookmarkClick"),w.call(this,a,b,a.getContent(b))}function v(a,b){i.utils.debug(3,"BookController.onChapterClick");w.call(this,a,b,a.getContent(b))}function w(a,b,c){i.utils.debug(3,"BookController.handleContentClick");var d=this;if("undefined"==typeof c.text){var e=function(e){i.utils.debug(4,"BookController.handleContentClick"),c.text=e,y.call(d,a,b)},f=function(a){i.utils.debug(3,"BookController.handleContentClick: "+a.message)};SpritzClient.fetchContents(c.url,e,f,c.selector)}else c.text.isLoaded()?m.call(this,a,b,c):l.call(this,a,b,c)}function x(){var a=this.spritzerController.getSpeed();return 0>=a&&(a=250),a}function y(a,b){var c=x.call(this);z(a,c),A(a,b,c),D.call(this,a,b),E.call(this,a,b)}function z(a,b){B(a.controls.totalTime,i.utils.timeToString(a.getTotalTotalTime(b))),B(a.controls.remainingTime,i.utils.timeToString(a.getTotalRemainingTime(b)))}function A(a,b,c){var d=a.getControls(b),e=i.utils.timeToString(a.getTotalTime(b,c));B(d.totalTime,e),C(d.chapterElement,"Total Time: "+e);var f=i.utils.timeToString(a.getRemainingTime(b,c));B(d.remainingTime,f),C(d.bookmarkElement,"Remaining Time: "+f)}function B(a,b){null!==a&&(a.textContent=b)}function C(a,b){null!==a&&(a.title=b)}function D(a,b){a.hasBookmark(b)?G.addClass(a.getControls(b).bookmarkElement,this.options.bookmarkImage):G.removeClass(a.getControls(b).bookmarkElement,this.options.bookmarkImage)}function E(a,b){var c=a.getControls(b);a.isCompleted(b)?(G.addClass(c.bookmarkElement,this.options.checkmarkImage),G.addClass(c.chapterElement,this.options.chapterCompleted),G.addClass(c.totalTime,this.options.chapterCompleted),G.addClass(c.remainingTime,this.options.chapterCompleted)):(G.removeClass(c.bookmarkElement,this.options.checkmarkImage),G.removeClass(c.chapterElement,this.options.chapterCompleted),G.removeClass(c.totalTime,this.options.chapterCompleted),G.removeClass(c.remainingTime,this.options.chapterCompleted))}function F(a){var b={},c={book:".spritz-book",bookTitle:".book-title",bookChapter:".book-chapter",bookName:".book-name",totalTime:".total-time",remainingTime:".remaining-time",statusImage:".status-image",chapterName:".chapter-name",bookmarkImage:"bookmark-image",checkmarkImage:"checkmark-image",chapterCompleted:"chapter-completed",textHighlighter:"text-highlighter"};return b="object"==typeof a?G.extend({},c,a):c}var G=i.helper;return{BookController:a}}),i.addToNamespace(i.bookmark,function(){function a(){var a=localStorage.getItem(this.storageKey);this.bookmarkData=null!==a&&"undefined"!=typeof a?JSON.parse(a):null}function b(){localStorage.setItem(this.storageKey,JSON.stringify(this.bookmarkData))}function c(){var a={};return a.createTime=(new Date).getTime(),a.updateTime=null,a.chapterPositions={},a}var d=function(b,c){this.bookmarkData=null,this.controls=c,this.storageKey="spritz.bookmark."+b,this.chapters={},a.call(this)};return d.prototype.addChapter=function(a,b,c){this.chapters[a]={content:b,controls:c}},d.prototype.getChapters=function(){return this.chapters},d.prototype.getContent=function(a){return this.chapters[a].content},d.prototype.getControls=function(a){return this.chapters[a].controls},d.prototype.getPosition=function(a){var b=null;return null!=this.bookmarkData&&(b=this.bookmarkData.chapterPositions[a],"undefined"==typeof b&&(b=0)),b},d.prototype.setPosition=function(a,d){null==this.bookmarkData&&(this.bookmarkData=c()),this.bookmarkData.updateTime=(new Date).getTime(),this.bookmarkData.chapterPositions[a]=d,b.call(this)},d.prototype.isCompleted=function(a){var b=this.getContent(a).text;return null!==b&&b.getWordCount()>0&&this.getPosition(a)>=b.getWordCount()},d.prototype.setCompleted=function(a){this.setPosition(a,this.getContent(a).text.getWordCount())},d.prototype.hasBookmark=function(a){var b=this.getPosition(a),c=this.getContent(a);return b>0&&b<c.text.getWordCount()},d.prototype.getTotalTime=function(a,b){var c=0,d=this.getContent(a);if(null!==d){var e=d.text;null!==e&&"undefined"!=typeof e&&(c=e.getTotalTime(b))}return c},d.prototype.getTotalTotalTime=function(a){var b=0;for(var c in this.chapters)this.chapters.hasOwnProperty(c)&&(b+=this.getTotalTime(c,a));return b},d.prototype.getRemainingTime=function(a,b){var c=0,d=this.getContent(a);if(null!==d){var e=d.text;null!==e&&"undefined"!=typeof e&&(c=this.isCompleted(a)?0:e.calculateTime(b,this.getPosition(a)))}return c},d.prototype.getTotalRemainingTime=function(a){var b=0;for(var c in this.chapters)this.chapters.hasOwnProperty(c)&&(b+=this.getRemainingTime(c,a));return b},{BookStore:d}});var l={};l.math={},l.math.Long=function(a,b){this.low_=0|a,this.high_=0|b},l.math.Long.IntCache_={},l.math.Long.fromInt=function(a){if(a>=-128&&128>a){var b=l.math.Long.IntCache_[a];if(b)return b}var c=new l.math.Long(0|a,0>a?-1:0);return a>=-128&&128>a&&(l.math.Long.IntCache_[a]=c),c},l.math.Long.fromNumber=function(a){return isNaN(a)||!isFinite(a)?l.math.Long.ZERO:a<=-l.math.Long.TWO_PWR_63_DBL_?l.math.Long.MIN_VALUE:a+1>=l.math.Long.TWO_PWR_63_DBL_?l.math.Long.MAX_VALUE:0>a?l.math.Long.fromNumber(-a).negate():new l.math.Long(a%l.math.Long.TWO_PWR_32_DBL_|0,a/l.math.Long.TWO_PWR_32_DBL_|0)},l.math.Long.fromBits=function(a,b){return new l.math.Long(a,b)},l.math.Long.fromString=function(a,b){if(0==a.length)throw Error("number format error: empty string");var c=b||10;if(2>c||c>36)throw Error("radix out of range: "+c);if("-"==a.charAt(0))return l.math.Long.fromString(a.substring(1),c).negate();if(a.indexOf("-")>=0)throw Error('number format error: interior "-" character: '+a);for(var d=l.math.Long.fromNumber(Math.pow(c,8)),e=l.math.Long.ZERO,f=0;f<a.length;f+=8){var g=Math.min(8,a.length-f),h=parseInt(a.substring(f,f+g),c);if(8>g){var i=l.math.Long.fromNumber(Math.pow(c,g));e=e.multiply(i).add(l.math.Long.fromNumber(h))}else e=e.multiply(d),e=e.add(l.math.Long.fromNumber(h))}return e},l.math.Long.TWO_PWR_16_DBL_=65536,l.math.Long.TWO_PWR_24_DBL_=1<<24,l.math.Long.TWO_PWR_32_DBL_=l.math.Long.TWO_PWR_16_DBL_*l.math.Long.TWO_PWR_16_DBL_,l.math.Long.TWO_PWR_31_DBL_=l.math.Long.TWO_PWR_32_DBL_/2,l.math.Long.TWO_PWR_48_DBL_=l.math.Long.TWO_PWR_32_DBL_*l.math.Long.TWO_PWR_16_DBL_,l.math.Long.TWO_PWR_64_DBL_=l.math.Long.TWO_PWR_32_DBL_*l.math.Long.TWO_PWR_32_DBL_,l.math.Long.TWO_PWR_63_DBL_=l.math.Long.TWO_PWR_64_DBL_/2,l.math.Long.ZERO=l.math.Long.fromInt(0),l.math.Long.ONE=l.math.Long.fromInt(1),l.math.Long.NEG_ONE=l.math.Long.fromInt(-1),l.math.Long.MAX_VALUE=l.math.Long.fromBits(-1,2147483647),l.math.Long.MIN_VALUE=l.math.Long.fromBits(0,-2147483648),l.math.Long.TWO_PWR_24_=l.math.Long.fromInt(1<<24),l.math.Long.prototype.toInt=function(){return this.low_},l.math.Long.prototype.toNumber=function(){return this.high_*l.math.Long.TWO_PWR_32_DBL_+this.getLowBitsUnsigned()},l.math.Long.prototype.toString=function(a){var b=a||10;if(2>b||b>36)throw Error("radix out of range: "+b);if(this.isZero())return"0";if(this.isNegative()){if(this.equals(l.math.Long.MIN_VALUE)){var c=l.math.Long.fromNumber(b),d=this.div(c),e=d.multiply(c).subtract(this);return d.toString(b)+e.toInt().toString(b)}return"-"+this.negate().toString(b)}for(var f=l.math.Long.fromNumber(Math.pow(b,6)),e=this,g="";;){var h=e.div(f),i=e.subtract(h.multiply(f)).toInt(),j=i.toString(b);if(e=h,e.isZero())return j+g;for(;j.length<6;)j="0"+j;g=""+j+g}},l.math.Long.prototype.getHighBits=function(){return this.high_},l.math.Long.prototype.getLowBits=function(){return this.low_},l.math.Long.prototype.getLowBitsUnsigned=function(){return this.low_>=0?this.low_:l.math.Long.TWO_PWR_32_DBL_+this.low_},l.math.Long.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(l.math.Long.MIN_VALUE)?64:this.negate().getNumBitsAbs();for(var a=0!=this.high_?this.high_:this.low_,b=31;b>0&&0==(a&1<<b);b--);return 0!=this.high_?b+33:b+1},l.math.Long.prototype.isZero=function(){return 0==this.high_&&0==this.low_},l.math.Long.prototype.isNegative=function(){return this.high_<0},l.math.Long.prototype.isOdd=function(){return 1==(1&this.low_)},l.math.Long.prototype.equals=function(a){return this.high_==a.high_&&this.low_==a.low_},l.math.Long.prototype.notEquals=function(a){return this.high_!=a.high_||this.low_!=a.low_},l.math.Long.prototype.lessThan=function(a){return this.compare(a)<0},l.math.Long.prototype.lessThanOrEqual=function(a){return this.compare(a)<=0},l.math.Long.prototype.greaterThan=function(a){return this.compare(a)>0},l.math.Long.prototype.greaterThanOrEqual=function(a){return this.compare(a)>=0},l.math.Long.prototype.compare=function(a){if(this.equals(a))return 0;var b=this.isNegative(),c=a.isNegative();return b&&!c?-1:!b&&c?1:this.subtract(a).isNegative()?-1:1},l.math.Long.prototype.negate=function(){return this.equals(l.math.Long.MIN_VALUE)?l.math.Long.MIN_VALUE:this.not().add(l.math.Long.ONE)},l.math.Long.prototype.add=function(a){var b=this.high_>>>16,c=65535&this.high_,d=this.low_>>>16,e=65535&this.low_,f=a.high_>>>16,g=65535&a.high_,h=a.low_>>>16,i=65535&a.low_,j=0,k=0,m=0,n=0;return n+=e+i,m+=n>>>16,n&=65535,m+=d+h,k+=m>>>16,m&=65535,k+=c+g,j+=k>>>16,k&=65535,j+=b+f,j&=65535,l.math.Long.fromBits(m<<16|n,j<<16|k)},l.math.Long.prototype.subtract=function(a){return this.add(a.negate())},l.math.Long.prototype.multiply=function(a){if(this.isZero())return l.math.Long.ZERO;if(a.isZero())return l.math.Long.ZERO;if(this.equals(l.math.Long.MIN_VALUE))return a.isOdd()?l.math.Long.MIN_VALUE:l.math.Long.ZERO;if(a.equals(l.math.Long.MIN_VALUE))return this.isOdd()?l.math.Long.MIN_VALUE:l.math.Long.ZERO;if(this.isNegative())return a.isNegative()?this.negate().multiply(a.negate()):this.negate().multiply(a).negate();if(a.isNegative())return this.multiply(a.negate()).negate();if(this.lessThan(l.math.Long.TWO_PWR_24_)&&a.lessThan(l.math.Long.TWO_PWR_24_))return l.math.Long.fromNumber(this.toNumber()*a.toNumber());var b=this.high_>>>16,c=65535&this.high_,d=this.low_>>>16,e=65535&this.low_,f=a.high_>>>16,g=65535&a.high_,h=a.low_>>>16,i=65535&a.low_,j=0,k=0,m=0,n=0;return n+=e*i,m+=n>>>16,n&=65535,m+=d*i,k+=m>>>16,m&=65535,m+=e*h,k+=m>>>16,m&=65535,k+=c*i,j+=k>>>16,k&=65535,k+=d*h,j+=k>>>16,k&=65535,k+=e*g,j+=k>>>16,k&=65535,j+=b*i+c*h+d*g+e*f,j&=65535,l.math.Long.fromBits(m<<16|n,j<<16|k)},l.math.Long.prototype.div=function(a){if(a.isZero())throw Error("division by zero");if(this.isZero())return l.math.Long.ZERO;if(this.equals(l.math.Long.MIN_VALUE)){if(a.equals(l.math.Long.ONE)||a.equals(l.math.Long.NEG_ONE))return l.math.Long.MIN_VALUE;if(a.equals(l.math.Long.MIN_VALUE))return l.math.Long.ONE;var b=this.shiftRight(1),c=b.div(a).shiftLeft(1);if(c.equals(l.math.Long.ZERO))return a.isNegative()?l.math.Long.ONE:l.math.Long.NEG_ONE;var d=this.subtract(a.multiply(c)),e=c.add(d.div(a));return e}if(a.equals(l.math.Long.MIN_VALUE))return l.math.Long.ZERO;if(this.isNegative())return a.isNegative()?this.negate().div(a.negate()):this.negate().div(a).negate();if(a.isNegative())return this.div(a.negate()).negate();for(var f=l.math.Long.ZERO,d=this;d.greaterThanOrEqual(a);){for(var c=Math.max(1,Math.floor(d.toNumber()/a.toNumber())),g=Math.ceil(Math.log(c)/Math.LN2),h=48>=g?1:Math.pow(2,g-48),i=l.math.Long.fromNumber(c),j=i.multiply(a);j.isNegative()||j.greaterThan(d);)c-=h,i=l.math.Long.fromNumber(c),j=i.multiply(a);i.isZero()&&(i=l.math.Long.ONE),f=f.add(i),d=d.subtract(j)}return f},l.math.Long.prototype.modulo=function(a){return this.subtract(this.div(a).multiply(a))},l.math.Long.prototype.not=function(){return l.math.Long.fromBits(~this.low_,~this.high_)},l.math.Long.prototype.and=function(a){return l.math.Long.fromBits(this.low_&a.low_,this.high_&a.high_)},l.math.Long.prototype.or=function(a){return l.math.Long.fromBits(this.low_|a.low_,this.high_|a.high_)},l.math.Long.prototype.xor=function(a){return l.math.Long.fromBits(this.low_^a.low_,this.high_^a.high_)},l.math.Long.prototype.shiftLeft=function(a){if(a&=63,0==a)return this;var b=this.low_;if(32>a){var c=this.high_;return l.math.Long.fromBits(b<<a,c<<a|b>>>32-a)}return l.math.Long.fromBits(0,b<<a-32)},l.math.Long.prototype.shiftRight=function(a){if(a&=63,0==a)return this;var b=this.high_;if(32>a){var c=this.low_;return l.math.Long.fromBits(c>>>a|b<<32-a,b>>a)}return l.math.Long.fromBits(b>>a-32,b>=0?0:-1)},l.math.Long.prototype.shiftRightUnsigned=function(a){if(a&=63,0==a)return this;var b=this.high_;if(32>a){var c=this.low_;return l.math.Long.fromBits(c>>>a|b<<32-a,b>>>a)}return 32==a?l.math.Long.fromBits(b,0):l.math.Long.fromBits(b>>>a-32,0)},i.helper.dispatchEvent(c,"spritz_loaded_internal"),i.helper.dispatchEvent(c,"spritz_loaded")}(window.SPRITZ=window.SPRITZ||{},window,document);